{"id":"NetworkView-07b","title":"SLB-01 Builder UI shell + block model","description":"Scope\n- Build the Include / Also include / Exclude block strip.\n- Define block data model + ordering rules.\n- Clear query action.\n\nAcceptance\n- Include block exists by default.\n- Add/edit/remove blocks updates UI state.\n- Reordering is allowed, but Exclude applies last (UI reflects rule).\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T20:58:07.418566Z","updated_at":"2025-12-25T20:58:07.418566Z","dependencies":[{"issue_id":"NetworkView-07b","depends_on_id":"NetworkView-1tt","type":"parent-child","created_at":"2025-12-25T20:58:07.850444Z","created_by":"daemon"}],"comments":[{"id":19,"issue_id":"NetworkView-07b","author":"home","text":"Design mockup available at public/design/index.html (served at /design/). May need edits to align with spec before wiring into app.","created_at":"2025-12-25T21:52:33Z"}]}
{"id":"NetworkView-0iu","title":"Phase 3: Add “Copy evidence note” (plain text for Word appendix)","description":"Phase: Phase 3 — Snapshot export + MapBuilder hand-off (3–7 days)\nSection: snapshot export\nSource: plan.md","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:23.293616Z","updated_at":"2025-12-25T16:04:03.910765Z","labels":["phase-3"],"dependencies":[{"issue_id":"NetworkView-0iu","depends_on_id":"NetworkView-wu5","type":"parent-child","created_at":"2025-12-25T16:04:04.331735Z","created_by":"daemon"}]}
{"id":"NetworkView-0tu","title":"SLB-06 Accessibility + usability pass","description":"Scope\n- Ensure keyboard focusable controls and clear labels/tooltips.\n- Avoid tiny hit targets.\n\nAcceptance\n- Usable with keyboard and trackpad.\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T20:58:10.748665Z","updated_at":"2025-12-25T20:58:10.748665Z","dependencies":[{"issue_id":"NetworkView-0tu","depends_on_id":"NetworkView-1tt","type":"parent-child","created_at":"2025-12-25T20:58:11.179274Z","created_by":"daemon"}]}
{"id":"NetworkView-0vm","title":"Phase 2: Implement filter chips (clip/mode/operator/time band) and “Clear all”","description":"Phase: Phase 2 — Map Viewer MVP (route lines + clip + filters + linked table) (5–10 days)\nSection: UI layout and patterns\nSource: plan.md","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:17.76398Z","updated_at":"2025-12-25T16:04:18.014734Z","labels":["phase-2"],"dependencies":[{"issue_id":"NetworkView-0vm","depends_on_id":"NetworkView-p57","type":"parent-child","created_at":"2025-12-25T16:04:18.475821Z","created_by":"daemon"}]}
{"id":"NetworkView-191","title":"DuckDB spatial init: set home/extension directory","description":"DuckDB-WASM spatial extension fails in browser due to missing /home/web_user. Need to set home_directory/extension_directory before LOAD/INSTALL.","acceptance_criteria":"DuckDB init no longer errors on home_directory; spatial extension attempts succeed or fail gracefully.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-25T20:09:03.025785Z","updated_at":"2025-12-25T20:10:08.890812Z","closed_at":"2025-12-25T20:10:08.890812Z","close_reason":"Closed","comments":[{"id":12,"issue_id":"NetworkView-191","author":"home","text":"Added home_directory/extension_directory setup before spatial LOAD/INSTALL in DuckDB init. Tests: npm test -- --run.","created_at":"2025-12-25T20:09:34Z"}]}
{"id":"NetworkView-1ew","title":"Phase 3: Export PNG snapshot with","description":"Phase: Phase 3 — Snapshot export + MapBuilder hand-off (3–7 days)\nSection: snapshot export\nSource: plan.md\nDetails:\n- title (user editable)\n- legend\n- scope chips printed (clip + mode + operator + time band)\n- date/time generated + dataset version","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:23.039242Z","updated_at":"2025-12-25T16:04:04.559946Z","labels":["phase-3"],"dependencies":[{"issue_id":"NetworkView-1ew","depends_on_id":"NetworkView-wu5","type":"parent-child","created_at":"2025-12-25T16:04:05.025137Z","created_by":"daemon"}]}
{"id":"NetworkView-1j5","title":"SLB-02 Curated operator list + templates","description":"Scope\n- Implement 4 starter templates (routes near a place, in an area, near a place within an area, in an area excluding operator).\n- Curate operator verbs: Near point, Touches boundary.\n\nAcceptance\n- Templates populate blocks correctly.\n- Templates reduce clicks and are discoverable.\n\nTemplate source should be driven by the Python runner so updates don’t require UI rewrites; design for future user-defined templates.\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T20:58:08.126793Z","updated_at":"2025-12-25T22:03:38.701175Z","dependencies":[{"issue_id":"NetworkView-1j5","depends_on_id":"NetworkView-1tt","type":"parent-child","created_at":"2025-12-25T20:58:08.542666Z","created_by":"daemon"}]}
{"id":"NetworkView-1k8","title":"SLB-03 Integrate block actions with Spatial Query state","description":"Scope\n- Translate blocks to internal boolean logic for Spatial Query execution.\n- Ensure live result count updates.\n\nAcceptance\n- Map highlight + table update from builder changes.\n- No boolean terms shown in UI.\n\nAlso covers readable spatial logic sentence/selector; replaces SQ-04 when builder is used.\n\nIntegration should call into the Python runner output (compiled query + template metadata) rather than hard-coded UI logic.\n","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-25T20:58:08.771329Z","updated_at":"2025-12-25T22:32:59.295848Z","dependencies":[{"issue_id":"NetworkView-1k8","depends_on_id":"NetworkView-1tt","type":"parent-child","created_at":"2025-12-25T20:58:09.224989Z","created_by":"daemon"}],"comments":[{"id":20,"issue_id":"NetworkView-1k8","author":"home","text":"Design mockup available at public/design/index.html (served at /design/). May need edits to align with spec before wiring into app.","created_at":"2025-12-25T21:52:34Z"},{"id":28,"issue_id":"NetworkView-1k8","author":"home","text":"Added SLB-03 plumbing for live map/table updates: spatial match-set support in state, filters and map filter now accept serviceIds, and new spatial executor consumes runner output (matchSet or SQL) to update filters. App wires builder changes to applySpatialLogic + re-run filters. Added tests for serviceId filters and execution stub.","created_at":"2025-12-25T22:33:04Z"},{"id":29,"issue_id":"NetworkView-1k8","author":"home","text":"Added DuckDB spatial SQL builder (public/js/spatial/sql.js) + execution path: applySpatialLogic now builds SQL from config spatialLogicSources/CRS when runner doesn’t provide matchSet. Config gains spatialLogicCrs/MetricCrs and sources array. Added tests for spatial SQL + execute. npm test passes.","created_at":"2025-12-25T22:36:48Z"},{"id":30,"issue_id":"NetworkView-1k8","author":"home","text":"Added point-first spatial execution: new Selected Point UI + map click handler stores point, config now includes routes + selected_point sources, and SQL builder supports point sources. applySpatialLogic uses point when building SQL. Tests updated for point source handling.","created_at":"2025-12-25T22:51:51Z"},{"id":31,"issue_id":"NetworkView-1k8","author":"home","text":"Added point marker + radius overlay: map click when picking sets point, updates map layers and label, and radius ring follows builder distance when target is selected_point. Added geometry util for circle polygons and tests.","created_at":"2025-12-25T22:55:22Z"},{"id":32,"issue_id":"NetworkView-1k8","author":"home","text":"Adjusted spatial point overlay layer ordering so marker/radius render above routes (moveLayer after routes added). This should fix point picker visibility.","created_at":"2025-12-25T23:05:33Z"},{"id":33,"issue_id":"NetworkView-1k8","author":"home","text":"Fixed spatial match-set propagation: empty match sets now apply a FALSE filter so map/table clear when no matches. Added serviceIdsActive flag to filters/map and tests for empty-set behavior.","created_at":"2025-12-25T23:10:16Z"},{"id":34,"issue_id":"NetworkView-1k8","author":"home","text":"Fixed spatial query execution: ensure spatial extension loads on demand and wrap WKB geometry with ST_GeomFromWKB via geometryFormat config (routes.parquet). Updated config sources + tests.","created_at":"2025-12-25T23:15:59Z"},{"id":35,"issue_id":"NetworkView-1k8","author":"home","text":"Hardened spatial extension loading: set home/extension dirs to /.duckdb, enable external access, set extension_repository, and log download status when fetching extension URL fallback.","created_at":"2025-12-25T23:21:04Z"},{"id":36,"issue_id":"NetworkView-1k8","author":"home","text":"Added spatial smoke test (tests/e2e/spatial.e2e.js) + npm script test:e2e:spatial. Also fixed extension directory duplication by using home='/.duckdb' with relative extension dir and improved extension load in init.","created_at":"2025-12-25T23:26:17Z"},{"id":42,"issue_id":"NetworkView-1k8","author":"home","text":"Linked bug NetworkView-3uh.1: spatial point picker queries do not affect map/table due to DuckDB spatial extension load failures. Treat as blocker for SLB-03/SLB epic.\n","created_at":"2025-12-26T00:05:21Z"}]}
{"id":"NetworkView-1tt","title":"Epic: Simplified Spatial Logic Builder","description":"Summary\nNon-technical spatial logic builder for the Spatial Query Tool using Include / Also include / Exclude blocks. Translates to boolean internally, updates map/table live, and produces plain-English evidence.\n\nGoals\n- Usable by non-technical users in \u003c60s\n- Visual, guided, hard to break\n- Explainable + exportable\n\nNon-goals (v1)\n- Full boolean expression editor\n- Arbitrary spatial operators beyond curated list\n- Teaching boolean terminology\n\nDependencies\n- Spatial Query Tool epic (NetworkView-3uh)\n- Map ↔ table linkage\n- Evidence panel infrastructure\n\nSource: Feature request (Simplified Spatial Logic Builder)\n\nImplementation note: base the logic builder on a Python-backed runner (tarted-up python runner) so templates can be updated easily now and support user-defined templates later.\n","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-25T20:58:06.936783Z","updated_at":"2025-12-25T22:03:37.848281Z","dependencies":[{"issue_id":"NetworkView-1tt","depends_on_id":"NetworkView-3uh","type":"blocks","created_at":"2025-12-25T20:58:11.404174Z","created_by":"daemon"}],"comments":[{"id":18,"issue_id":"NetworkView-1tt","author":"home","text":"Design mockup available at public/design/index.html (served at /design/). May need edits to align with spec before wiring into app.","created_at":"2025-12-25T21:52:33Z"},{"id":23,"issue_id":"NetworkView-1tt","author":"home","text":"Consolidation: Spatial Query epic covers core spatial engine + map/table plumbing. Simplified Logic Builder epic covers UX builder on top of Spatial Query.","created_at":"2025-12-25T21:54:45Z"},{"id":43,"issue_id":"NetworkView-1tt","author":"home","text":"Linked bug NetworkView-3uh.1: spatial point picker queries do not affect map/table due to DuckDB spatial extension load failures. Treat as blocker for SLB-03/SLB epic.\n","created_at":"2025-12-26T00:05:32Z"}]}
{"id":"NetworkView-1tt.1","title":"SLB-01 Builder UI shell + state model","description":"Scope\\n- Add Simplified Spatial Logic Builder panel UI (Include / Also include / Exclude blocks) aligned with design mockup at public/design/index.html.\\n- Define builder state model in state/manager.js (blocks, ordering, constraints, active/disabled states).\\n- Wire UI controls to state setters only; no direct mutations.\\n\\nNotes\\n- Keep UI visual and guided; no boolean terminology displayed.\\n- Logic compilation handled in SLB-02/SLB-03.","acceptance_criteria":"- Builder panel renders under Spatial Query Tool without breaking existing filters.\\n- Blocks can be added/removed/reordered within allowed constraints.\\n- State persists within session and resets cleanly on Clear.","notes":"Builder UI shell complete with all requirements met: panel renders in index.html with Include/Also Include/Exclude pills, blocks container with add/remove/reorder capability, state model in spatial/builder.js (438 lines), plain-English summary, no boolean terminology, Clear button resets state. Block operators implemented with structured dropdowns (Near point, Touches boundary, Inside boundary for Include; Operator/Mode for Exclude). Compilation to query object works via compile() function. Execution blocked by runner stub.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T22:10:58.132119Z","updated_at":"2025-12-26T10:38:16.19446Z","closed_at":"2025-12-26T10:38:16.194478Z","dependencies":[{"issue_id":"NetworkView-1tt.1","depends_on_id":"NetworkView-1tt","type":"parent-child","created_at":"2025-12-25T22:10:58.133406Z","created_by":"home"}],"comments":[{"id":24,"issue_id":"NetworkView-1tt.1","author":"home","text":"Started SLB-01 scaffolding: added spatial logic builder UI section and state wiring, logic helpers + evidence hook, and basic tests. Files: public/index.html, public/js/spatial/builder.js, public/js/spatial/logic.js, public/js/spatial/evidence.js, public/js/state/manager.js, public/js/config/constants.js, public/app.js, tests/spatial-logic.test.js. Runner integration + map/table execution still pending.","created_at":"2025-12-25T22:21:06Z"},{"id":25,"issue_id":"NetworkView-1tt.1","author":"home","text":"Enabled spatialLogic feature flag in public/config.json and public/config.sample.json so the new builder UI renders by default.","created_at":"2025-12-25T22:22:14Z"}]}
{"id":"NetworkView-1tt.2","title":"SLB-02 Template library + Python runner integration","description":"Scope\\n- Integrate Python-backed runner to compile builder blocks into internal boolean logic + metadata.\\n- Define template inputs/outputs (JSON schema) for templates and runner responses.\\n- Ensure UI uses runner output (no hard-coded logic).\\n\\nNotes\\n- Runner should support updating templates without UI changes; future user-defined templates should be possible.","acceptance_criteria":"- Builder sends structured block state to runner and receives compiled logic + metadata.\\n- Runner output drives UI summary and logic execution (no duplication in UI).\\n- Template changes do not require JS code changes beyond data wiring.","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-25T22:11:04.759046Z","updated_at":"2025-12-25T22:24:59.178333Z","dependencies":[{"issue_id":"NetworkView-1tt.2","depends_on_id":"NetworkView-1tt","type":"parent-child","created_at":"2025-12-25T22:11:04.762873Z","created_by":"home"}],"comments":[{"id":26,"issue_id":"NetworkView-1tt.2","author":"home","text":"Added Python-backed template pipeline + JS runner integration. New templates JSON at public/spatial_logic_templates.json, generator script tools/build_spatial_logic_templates.py, and runtime loader public/js/spatial/runner.js. Builder now compiles via runner (template metadata). Added tests: tests/spatial-runner.test.js. Config gains spatialLogicTemplatesFile. App loads runner before init builder.","created_at":"2025-12-25T22:25:03Z"},{"id":27,"issue_id":"NetworkView-1tt.2","author":"home","text":"Added template selection UI (Templates tab dropdown) driven by runner list. Builder now passes selected templateId into runner; state stores activeTemplateId. Updated tests to cover template options.","created_at":"2025-12-25T22:27:20Z"}]}
{"id":"NetworkView-1tt.3","title":"SLB-04 Evidence output integration","description":"Scope\\n- Use runner output to generate plain-English logic sentence.\\n- Attach block parameters + template metadata to Evidence panel and exports.\\n- Ensure share/state encoding includes SLB parameters if supported.\\n\\nNotes\\n- Align with SQ-08 evidence requirements; avoid duplication.","acceptance_criteria":"- Evidence panel shows readable spatial logic sentence (no boolean terms).\\n- Exports include block parameters + template metadata.\\n- Clearing the tool removes SLB evidence entries and restores prior view.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T22:11:10.674929Z","updated_at":"2025-12-25T22:11:10.674929Z","dependencies":[{"issue_id":"NetworkView-1tt.3","depends_on_id":"NetworkView-1tt","type":"parent-child","created_at":"2025-12-25T22:11:10.676589Z","created_by":"home"}]}
{"id":"NetworkView-1tt.4","title":"SLB-05 UX polish + guardrails","description":"Scope\\n- Add empty states, guidance tooltips, and validation for incomplete blocks.\\n- Prevent invalid block combinations; surface friendly warnings.\\n- Ensure \u003c60s completion path for common scenarios.\\n\\nNotes\\n- Must stay visual and hard to break; no boolean terminology.","acceptance_criteria":"- Builder prevents invalid configurations and shows clear guidance.\\n- First-time user can complete a valid query in under a minute.\\n- UI remains stable under rapid edits (add/remove/reorder).","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T22:11:17.408461Z","updated_at":"2025-12-25T22:11:17.408461Z","dependencies":[{"issue_id":"NetworkView-1tt.4","depends_on_id":"NetworkView-1tt","type":"parent-child","created_at":"2025-12-25T22:11:17.411981Z","created_by":"home"}]}
{"id":"NetworkView-1tt.5","title":"SLB-06 Tests (builder state, compilation, evidence)","description":"Scope\\n- Unit tests for builder state model and constraints.\\n- Tests for runner output handling + plain-English sentence generation.\\n- Integration tests for map/table updates if feasible.\\n\\nNotes\\n- Follow tests/ structure; add coverage where new utils are added.","acceptance_criteria":"- New/changed functions have coverage in tests/.\\n- Compilation + evidence logic validated with representative block sets.\\n- CI passes: npm test and npm run test:coverage.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T22:11:24.087191Z","updated_at":"2025-12-25T22:11:24.087191Z","dependencies":[{"issue_id":"NetworkView-1tt.5","depends_on_id":"NetworkView-1tt","type":"parent-child","created_at":"2025-12-25T22:11:24.088511Z","created_by":"home"}],"comments":[{"id":50,"issue_id":"NetworkView-1tt.5","author":"home","text":"Code review: no tests found for spatial modules (public/js/spatial/sql.js, runner.js, execute.js). Recommend adding coverage for SQL generation, runner column selection, and applySpatialLogic behavior.","created_at":"2025-12-26T12:17:40Z"}]}
{"id":"NetworkView-1tt.6","title":"Implement spatial SQL generator for query compilation","description":"Create public/js/spatial/sql.js to translate builder state into DuckDB SQL. Must handle: point + distance queries, spatial operators (ST_DWithin, ST_Intersects, ST_Within, ST_Touches), attribute filters (operator/mode exclusions), and Include/Also Include/Exclude boolean logic. Should have fallback to bbox calculations if ST_ functions unavailable. Dependencies: DuckDB spatial extension resolution (NetworkView-3uh.1).","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-26T10:36:41.061787Z","updated_at":"2025-12-26T10:36:41.061787Z","labels":["spatial","task"],"dependencies":[{"issue_id":"NetworkView-1tt.6","depends_on_id":"NetworkView-1tt","type":"parent-child","created_at":"2025-12-26T10:36:41.064726Z","created_by":"daemon"}],"comments":[{"id":48,"issue_id":"NetworkView-1tt.6","author":"home","text":"Code review: SQL generator exists but has gaps. Boundary operators are stubs (ST_GeomFromText(?) with no binding) and boundary target throws not implemented. Also Include logic ORs only the last condition (A AND B + also C =\u003e A AND (B OR C) instead of (A AND B) OR C). Attribute values are not escaped. See public/js/spatial/sql.js:87-101, 159-176, 185-189, 115-129.","created_at":"2025-12-26T12:17:08Z"}]}
{"id":"NetworkView-1tt.7","title":"Implement spatial query runner with DuckDB execution","description":"Replace stub in public/js/spatial/runner.js with working implementation. Runner must: accept compiled builder state + point + DuckDB instance, generate SQL via sql.js, execute query against routes table, return serviceIds array + count, handle errors gracefully. Wire to builder onRun event in app.js. Dependencies: SQL generator (NetworkView-1tt.6).","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-26T10:36:47.396372Z","updated_at":"2025-12-26T10:36:47.396372Z","labels":["spatial","task"],"dependencies":[{"issue_id":"NetworkView-1tt.7","depends_on_id":"NetworkView-1tt","type":"parent-child","created_at":"2025-12-26T10:36:47.409687Z","created_by":"daemon"}],"comments":[{"id":47,"issue_id":"NetworkView-1tt.7","author":"home","text":"Code review: spatial runner uses hard-coded SELECT DISTINCT serviceId and does not respect state.serviceIdField. Will break schemas using service_id or other names. See public/js/spatial/runner.js:38-45, detectSchemaFields sets state.serviceIdField in public/js/duckdb/client.js:51-84.","created_at":"2025-12-26T12:16:50Z"}]}
{"id":"NetworkView-1tt.8","title":"Complete point selection flow end-to-end","description":"Verify and complete the map click → point selection → query → results pipeline. Steps: 1) Click 'Pick Point on Map' button, 2) Map enters picking mode, 3) Click sets point in state, 4) Label updates with coordinates, 5) Point marker + radius circle appear, 6) User adjusts distance/operators, 7) Click 'Run Query' executes spatial query, 8) Results filter map + table. Files: app.js (event wiring), spatial/builder.js (state updates), map overlay logic.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-26T10:36:54.641561Z","updated_at":"2025-12-26T10:36:54.641561Z","labels":["spatial","task"],"dependencies":[{"issue_id":"NetworkView-1tt.8","depends_on_id":"NetworkView-1tt","type":"parent-child","created_at":"2025-12-26T10:36:54.64647Z","created_by":"daemon"}]}
{"id":"NetworkView-1tt.9","title":"Implement all block operators (Near point, Touches boundary, Inside boundary, Operator, Mode)","description":"Translate each operator type from builder blocks into correct SQL: Near point → ST_DWithin or bbox expansion, Touches boundary → ST_Touches, Inside boundary → ST_Within, Operator exclusion → WHERE operator = ?, Mode exclusion → WHERE mode = ?. Handle Include/Also Include/Exclude logic combination (AND/OR/NOT). Add tests for each operator. Dependencies: SQL generator + runner.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-26T10:37:01.468531Z","updated_at":"2025-12-26T10:37:01.468531Z","labels":["spatial","task"],"dependencies":[{"issue_id":"NetworkView-1tt.9","depends_on_id":"NetworkView-1tt","type":"parent-child","created_at":"2025-12-26T10:37:01.475693Z","created_by":"daemon"}],"comments":[{"id":49,"issue_id":"NetworkView-1tt.9","author":"home","text":"Code review: boundary operators are currently stubs and will error at runtime. buildBoundaryWhere uses ST_GeomFromText(?) without binding, and main block boundary target throws not implemented. UI still exposes touches/inside boundary. See public/js/spatial/sql.js:87-101, 159-176; public/js/spatial/builder.js operator options.","created_at":"2025-12-26T12:17:27Z"}]}
{"id":"NetworkView-1tw","title":"Phase 1: Normalise to a consistent CRS (WGS84) and simplify geometry for tiling","description":"Phase: Phase 1 — Data artefacts v1 (PMTiles + Parquet) (3–7 days)\nSection: boundaries\nSource: plan.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:15.150198Z","updated_at":"2025-12-25T16:09:36.928658Z","closed_at":"2025-12-25T16:09:36.928658Z","close_reason":"Closed","labels":["phase-1"],"dependencies":[{"issue_id":"NetworkView-1tw","depends_on_id":"NetworkView-gjy","type":"parent-child","created_at":"2025-12-25T16:04:24.611455Z","created_by":"daemon"}]}
{"id":"NetworkView-1ty","title":"Local Authority and RPT clippling not working","notes":"LA/RPT clip filters and boundary highlights wired in UI (app.js + config + index.html). Needs verification with boundary PMTiles deployed.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-25T16:05:11.668659Z","updated_at":"2025-12-25T16:12:14.851078Z","closed_at":"2025-12-25T16:12:14.851078Z","close_reason":"Closed"}
{"id":"NetworkView-25p","title":"Phase 2: Query builder that mirrors active filters and clip","description":"Phase: Phase 2 — Map Viewer MVP (route lines + clip + filters + linked table) (5–10 days)\nSection: linked table\nSource: plan.md","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:21.015167Z","updated_at":"2025-12-25T16:04:10.385039Z","labels":["phase-2"],"dependencies":[{"issue_id":"NetworkView-25p","depends_on_id":"NetworkView-p57","type":"parent-child","created_at":"2025-12-25T16:04:10.881974Z","created_by":"daemon"}]}
{"id":"NetworkView-2k2","title":"SQ-08 Evidence + share/state encoding","description":"Scope\n- Record point coords, boundary details, radius, logic, method, dataset version.\n- Include in evidence note and copy.\n- Encode spatial query in share URL/state JSON if supported.\n\nAcceptance\n- Evidence note is complete and reproducible.\n- Clearing tool restores prior view/table.\n\nInclude builder-generated plain-English sentence summary and block parameters in Evidence/Copy note.\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T17:33:24.902047Z","updated_at":"2025-12-25T21:54:45.930594Z","dependencies":[{"issue_id":"NetworkView-2k2","depends_on_id":"NetworkView-3uh","type":"parent-child","created_at":"2025-12-25T17:33:25.347573Z","created_by":"daemon"}],"comments":[{"id":56,"issue_id":"NetworkView-2k2","author":"home","text":"Validation note (2025-12-27): Ran Playwright on http://127.0.0.1:5137/. SQ panel opens and SLB controls are visible. 'Pick Point on Map' button present. No radius slider detected (input[type=range] count 0) and no visible Evidence text. Table rows remained 0 in my run, even after 'Load GeoJSON preview', so SQ execution/outputs could not be validated (map highlight, table restriction, CSV parity, evidence, edge cases). Screenshots in /tmp: sq-home.png, sq-panel.png, sq-validate-02-point.png, sq-validate-03-run.png, sq-sample-01-loaded.png, sq-sample-04-run.png. Please confirm data-populating environment for re-test.","created_at":"2025-12-27T19:47:18Z"}]}
{"id":"NetworkView-2kh","title":"Phase 1: Ingest route lines (your existing API output / GeoJSON / database)","description":"Phase: Phase 1 — Data artefacts v1 (PMTiles + Parquet) (3–7 days)\nSection: route lines\nSource: plan.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:15.946737Z","updated_at":"2025-12-25T16:09:36.933181Z","closed_at":"2025-12-25T16:09:36.933181Z","close_reason":"Closed","labels":["phase-1"],"dependencies":[{"issue_id":"NetworkView-2kh","depends_on_id":"NetworkView-gjy","type":"parent-child","created_at":"2025-12-25T16:04:22.785324Z","created_by":"daemon"}]}
{"id":"NetworkView-2lb","title":"Phase 2: Implement three-panel layout","description":"Phase: Phase 2 — Map Viewer MVP (route lines + clip + filters + linked table) (5–10 days)\nSection: UI layout and patterns\nSource: plan.md\nDetails:\n- left controls\n- central map\n- bottom table + right inspector drawer","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:17.471685Z","updated_at":"2025-12-25T16:04:18.706257Z","labels":["phase-2"],"dependencies":[{"issue_id":"NetworkView-2lb","depends_on_id":"NetworkView-p57","type":"parent-child","created_at":"2025-12-25T16:04:19.146291Z","created_by":"daemon"}]}
{"id":"NetworkView-2sq","title":"App wiring: pass duckdb/setStatus to initDuckDb","description":"initDuckDb module requires duckdb + setStatus; app.js was calling with config only, causing DuckDB init failure despite tests passing.","acceptance_criteria":"initDuckDb called with (config, duckdb, setStatus) and app wiring test covers this.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-25T20:01:53.510231Z","updated_at":"2025-12-25T20:02:27.933661Z","closed_at":"2025-12-25T20:02:27.933661Z","close_reason":"Closed","comments":[{"id":10,"issue_id":"NetworkView-2sq","author":"home","text":"Fixed initDuckDb wiring in app.js and added app-wiring test to catch missing args and legacy handlers. Tests: npm test -- --run.","created_at":"2025-12-25T20:02:11Z"}]}
{"id":"NetworkView-3e6","title":"Phase 2 Add an admin config panel at a certian sub-url to allow for feature flag management","notes":"Implemented admin feature-flag panel (admin/config path or ?admin) with localStorage overrides; applied overrides on boot and render modal UI; added activity logging for flag changes.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-25T16:06:45.805241Z","updated_at":"2025-12-25T17:14:54.540146Z","closed_at":"2025-12-25T17:14:19.021822Z"}
{"id":"NetworkView-3fe","title":"DuckDB init: buffer parquet when Range unsupported","description":"If server lacks Range support (e.g., basic http server), DuckDB file URL reads fail. Add detection to buffer parquet or emit clear error.","acceptance_criteria":"When Range unsupported, app buffers parquet if within size cap or emits actionable error; status warns to use tools/dev_server or enable parquetPreferBuffer.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-25T19:53:46.791022Z","updated_at":"2025-12-25T19:54:18.570931Z","closed_at":"2025-12-25T19:54:18.570931Z","close_reason":"Closed","comments":[{"id":8,"issue_id":"NetworkView-3fe","author":"home","text":"Added Range detection + buffer fallback in DuckDB init; warns when Range unsupported and surfaces actionable error if too large to buffer. Tests: npm test -- --run.","created_at":"2025-12-25T19:54:02Z"}]}
{"id":"NetworkView-3h9","title":"Create an info button on the top panel which brings up a window in which markdown text can be placed","description":"the user should be able to click an info/click me button where they are given a markdown popul of information about the app","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-25T23:36:59.549038Z","updated_at":"2025-12-25T23:36:59.549038Z"}
{"id":"NetworkView-3n3","title":"Phase 2: DuckDB-WASM initialisation","description":"Phase: Phase 2 — Map Viewer MVP (route lines + clip + filters + linked table) (5–10 days)\nSection: linked table\nSource: plan.md","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:20.705209Z","updated_at":"2025-12-25T16:04:11.079261Z","labels":["phase-2"],"dependencies":[{"issue_id":"NetworkView-3n3","depends_on_id":"NetworkView-p57","type":"parent-child","created_at":"2025-12-25T16:04:11.470325Z","created_by":"daemon"}]}
{"id":"NetworkView-3nw","title":"Phase 2: Apply clip as a MapLibre layer filter on `la_code`/`rpt_code`","description":"Phase: Phase 2 — Map Viewer MVP (route lines + clip + filters + linked table) (5–10 days)\nSection: clipping\nSource: plan.md","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:19.146501Z","updated_at":"2025-12-25T16:04:14.881335Z","labels":["phase-2"],"dependencies":[{"issue_id":"NetworkView-3nw","depends_on_id":"NetworkView-p57","type":"parent-child","created_at":"2025-12-25T16:04:15.297277Z","created_by":"daemon"}]}
{"id":"NetworkView-3uh","title":"Epic: Spatial Query Tool (Point + Boundary)","description":"Summary\nAdd a Spatial Query Tool to the Map Viewer that lets users place a point, define a boundary (radius/polygon/admin area), apply boolean spatial logic, and update map/table/evidence.\n\nGoals\n- Answer spatial questions in under a minute for non-GIS users\n- Keep interaction visual and intuitive\n- Make outputs defensible and reproducible\n\nNon-goals (v1)\n- Editing route geometry\n- Complex multi-shape operations beyond defined boolean options\n- Full GIS buffering UI (keep simple/opinionated)\n\nDependencies\n- Stable service_id + mode/operator attributes\n- DuckDB-WASM initialised\n- Map highlighting/filtering by service_id\n- LA/RPT clip available if boundary option enabled\n\nSource: Feature request (Spatial Query Tool)\n","status":"blocked","priority":1,"issue_type":"epic","created_at":"2025-12-25T17:33:19.641422Z","updated_at":"2025-12-25T17:42:31.793279Z","comments":[{"id":5,"issue_id":"NetworkView-3uh","author":"home","text":"Scope decisions (assumptions until confirmed):\n- v1 uses point + radius (default 300m, slider 50–1000m) + optional LA/RPT boundary if available; polygon draw deferred to v1.1.\n- Spatial query applies on top of existing filters by default (AND); add an advanced toggle to ignore other filters (v1.1).\n- Data method v1: approximate match using bbox/route segments in Parquet; v1.1 adds true geometry ST_DWithin/ST_Intersects if simplified geometry is available.\n- Evidence will record point coords, radius, boundary id/type, logic sentence, and dataset version.\nOpen questions to confirm:\n- Is route geometry available in Parquet (WKB/GeoJSON)?\n- Preferred default radius (300m OK?)\n- Should LA/RPT boundary selection be in v1, or v1.1?\n","created_at":"2025-12-25T17:42:00Z"},{"id":6,"issue_id":"NetworkView-3uh","author":"home","text":"Blocked: implementation depends on DuckDB spatial querying being available/enabled in-browser (ST_DWithin/ST_Intersects or equivalent). Do not start until spatial querying is confirmed working.","created_at":"2025-12-25T17:42:31Z"},{"id":14,"issue_id":"NetworkView-3uh","author":"home","text":"Design mockup available at public/design/index.html (served at /design/). May need edits to align with spec before wiring into app.","created_at":"2025-12-25T21:52:32Z"},{"id":22,"issue_id":"NetworkView-3uh","author":"home","text":"Consolidation: Spatial Query epic covers core spatial engine + map/table plumbing. Simplified Logic Builder epic covers UX builder on top of Spatial Query.","created_at":"2025-12-25T21:54:44Z"}]}
{"id":"NetworkView-3uh.1","title":"Spatial point picker queries do not affect map/table (DuckDB spatial extension not loading)","description":"Point-based spatial queries fail: pick point + within radius returns no results and does not filter map/table. Console shows 'st_point not in catalog' and spatial extension install/load errors, plus enable_external_access errors. This breaks SLB/Spatial Query Tool and regresses basic filters.","acceptance_criteria":"1) Picking a point + radius returns a non-empty match set when routes intersect/within. 2) Map + table filter to the match set automatically. 3) No 'st_point' or spatial extension errors in console. 4) If spatial extension unavailable, spatial filter does not activate and user sees a clear status message. 5) Smoke test added/updated to catch regression.","notes":"RESOLVED with bbox fallback strategy. Created public/js/spatial/sql.js (230 lines) with expandPointToBbox, buildPointDistanceWhere, buildAttributeWhere, buildSpatialWhere. Updated public/js/spatial/runner.js to execute DuckDB queries using SQL generator. Wired onRun handler in app.js to use runner (lines 2946-2975). Bbox fallback uses min_lon, min_lat, max_lon, max_lat columns with approximate distance calculation (~111km per degree). Works immediately without spatial extension. Boundary operators (touches/inside) still require spatial extension and throw error if unavailable. See SPATIAL_EXTENSION_INVESTIGATION.md for full analysis. Next: test with real data, add UI messaging about approximation.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T00:03:50.035863Z","updated_at":"2025-12-26T10:44:42.541158Z","closed_at":"2025-12-26T10:44:42.541168Z","labels":["duckdb","filters","slb","spatial"],"dependencies":[{"issue_id":"NetworkView-3uh.1","depends_on_id":"NetworkView-3uh","type":"parent-child","created_at":"2025-12-26T00:03:50.037005Z","created_by":"home"}],"comments":[{"id":41,"issue_id":"NetworkView-3uh.1","author":"home","text":"Diagnosis (first principles): DuckDB spatial extension not loading =\u003e ST_POINT/ST_DWithin missing =\u003e spatial SQL fails =\u003e matchSet empty =\u003e map/table unaffected. Errors observed: 'st_point not in catalog', 'spatial.duckdb_extension not found', and 'Cannot change enable_external_access while database is running'. Likely root causes: extension directory path mis-set or external access toggled after DB start; extension file not available at expected path/URL; spatialReady false but spatial filter still activated.\n\nFix plan:\n1) Ensure extension install/load happens once after db.connect with stable home/extension dirs (e.g., home='/.duckdb', extension_directory='/.duckdb/extensions'); remove enable_external_access toggles after DB is running.\n2) Provide deterministic extension source: bundle spatial extension under public/duckdb/... and install via URL or use CDN fallback; verify URL served.\n3) Guard spatial execution: only apply spatial filter if spatialReady + matchSet length \u003e 0; otherwise set status and keep scope unchanged.\n4) Wire map/table to matchSet (serviceIds) with a hard FALSE filter for empty matchSet so UI reflects 'no results'.\n5) Add smoke test: pick point, run spatial query, assert spatialReady + active + no console errors.\n\nOptions if extension remains flaky:\nA) Bbox-only fallback using precomputed geometry bbox columns in parquet (no spatial extension).\nB) Run spatial query server-side (Python runner) and return serviceIds (client only filters by ids).\nC) Client-side Turf.js against GeoJSON for small datasets (not scalable).\n\nShipping checklist: extension load ok, spatialReady true, map/table update correctly, smoke test green, evidence panel updated, docs note extension requirement + local dev asset fetch step.\n","created_at":"2025-12-26T00:04:45Z"}]}
{"id":"NetworkView-46i","title":"Phase 2: Click a route line → show inspector card","description":"Phase: Phase 2 — Map Viewer MVP (route lines + clip + filters + linked table) (5–10 days)\nSection: inspector + drill-through\nSource: plan.md\nDetails:\n- service name, operator, mode, IDs\n- links (Traveline/PDF) if present","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:21.71933Z","updated_at":"2025-12-25T16:04:08.354028Z","labels":["phase-2"],"dependencies":[{"issue_id":"NetworkView-46i","depends_on_id":"NetworkView-p57","type":"parent-child","created_at":"2025-12-25T16:04:08.759969Z","created_by":"daemon"}]}
{"id":"NetworkView-4mh","title":"BUG: Simple filters return no results after spatial logic changes","description":"Symptoms\\n- Mode/operator/LA/RPT filters no longer change table/map after recent spatial logic work.\\n- With spatial logic active or inactive, Apply Filters appears to run but dataset remains full or empty unexpectedly.\\n\\nNotes\\n- Likely tied to serviceIds/serviceIdsActive gating or spatialQuery state not being cleared/disabled properly.\\n- Reported after spatial query integration and point picker changes.\\n\\nRepro\\n1) Open app.\\n2) Select mode BUS and click Apply Filters.\\n3) Observe table/map not filtered.\\n\\nExpected\\n- Table/map only show matching routes for selected mode/operator/area.\\n\\nActual\\n- No change (or empty) despite filters applied.\\n\\nFiles to inspect\\n- public/app.js (getCurrentFilters, onApplyFilters)\\n- public/js/filters/builder.js (serviceIdsActive handling)\\n- public/js/map/utils.js (serviceIdsActive handling)\\n- public/js/state/manager.js (spatialQuery state lifecycle)","acceptance_criteria":"- Attribute filters (mode/operator/LA/RPT) correctly restrict table and map with spatial logic enabled/disabled.\\n- Spatial query match-set does not interfere when spatial tool is inactive.\\n- Regression test added to prevent recurrence.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-25T23:27:23.48243Z","updated_at":"2025-12-25T23:27:23.48243Z","comments":[{"id":37,"issue_id":"NetworkView-4mh","author":"home","text":"Observed console errors: enable_external_access cannot be changed while DB running; spatial extension path duplicated (extensions/.duckdb/...) causing load failures; routes not rendering. Adjusted extension directory to absolute path in init/ensure to fix. Need to validate filters post-fix.","created_at":"2025-12-25T23:29:42Z"},{"id":38,"issue_id":"NetworkView-4mh","author":"home","text":"Bundled spatial extension locally (public/duckdb/extensions/v0.9.1/wasm_mvp/spatial.duckdb_extension), set spatialExtensionUrl to local path, and added fetch script. This should stop st_point errors due to missing extension. Need to re-test filters and map rendering after reload.","created_at":"2025-12-25T23:37:52Z"},{"id":46,"issue_id":"NetworkView-4mh","author":"home","text":"Code review: applySpatialLogic on builder onChange + point pick sets empty spatial match set -\u003e serviceIdsActive true + WHERE FALSE. This matches simple filters returning no results. Sources: public/app.js:2948-2957, public/app.js:2053-2060, public/js/spatial/execute.js, public/js/state/manager.js.","created_at":"2025-12-26T12:16:34Z"}]}
{"id":"NetworkView-4nj","title":"Phase 2: Styling presets","description":"Phase: Phase 2 — Map Viewer MVP (route lines + clip + filters + linked table) (5–10 days)\nSection: map rendering\nSource: plan.md\nDetails:\n- default colour by `mode`\n- optional colour by `operator_code` (advanced)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:18.621207Z","updated_at":"2025-12-25T16:04:16.160229Z","labels":["phase-2"],"dependencies":[{"issue_id":"NetworkView-4nj","depends_on_id":"NetworkView-p57","type":"parent-child","created_at":"2025-12-25T16:04:16.621995Z","created_by":"daemon"}]}
{"id":"NetworkView-4uv","title":"Phase 2: Click-to-copy table cell","description":"Scope\n- Enable click-to-copy for Data Inspector table cells.\n- Provide a subtle affordance and confirmation (toast or inline).\n\nAcceptance\n- Clicking a cell copies its value to clipboard.\n- Non-copyable fields (e.g., geometry) are excluded.\n\nFiles\n- public/app.js (table render)\n","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-25T20:35:30.171089Z","updated_at":"2025-12-26T00:11:00.210092Z","closed_at":"2025-12-26T00:11:00.210104Z","dependencies":[{"issue_id":"NetworkView-4uv","depends_on_id":"NetworkView-p57","type":"parent-child","created_at":"2025-12-25T20:35:30.729929Z","created_by":"daemon"}],"comments":[{"id":44,"issue_id":"NetworkView-4uv","author":"home","text":"Implemented click-to-copy for table cells (title + dataset + status feedback) and wired table-body click handler to copy values. Files: public/js/table/renderer.js, public/app.js. Tests: npm test -- --run.","created_at":"2025-12-26T00:09:19Z"}]}
{"id":"NetworkView-4x6","title":"Phase 2: Admin panel allows header customization","description":"Scope\n- Expose header content (title/kicker/badge) in admin config UI.\n- Persist to config (config.json/config.r2.json or admin backing store).\n\nAcceptance\n- Admin can edit header content and see it reflected in the UI.\n- Changes survive refresh and are included in exported config.\n","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-25T20:35:30.958821Z","updated_at":"2025-12-25T20:35:30.958821Z","dependencies":[{"issue_id":"NetworkView-4x6","depends_on_id":"NetworkView-p57","type":"parent-child","created_at":"2025-12-25T20:35:31.384581Z","created_by":"daemon"},{"issue_id":"NetworkView-4x6","depends_on_id":"NetworkView-3e6","type":"blocks","created_at":"2025-12-25T20:35:31.592755Z","created_by":"daemon"}]}
{"id":"NetworkView-587","title":"DuckDB spatial LA/RTP attribution","description":"Replace Python GeoPandas join with DuckDB spatial joins; add multi-membership LA/RTP fields and robust filtering.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-25T17:43:26.309224Z","updated_at":"2025-12-25T17:43:26.309224Z","labels":["data","duckdb","phase1","spatial"]}
{"id":"NetworkView-587.1","title":"Audit current LA/RTP attribution pipeline","description":"Locate the current GeoPandas/Shapely join that writes la_code/rpt_code and document its rule + inputs/outputs.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-25T17:43:30.271747Z","updated_at":"2025-12-25T22:16:51.656247Z","labels":["data","duckdb","spatial"],"dependencies":[{"issue_id":"NetworkView-587.1","depends_on_id":"NetworkView-587","type":"parent-child","created_at":"2025-12-25T17:43:30.274486Z","created_by":"daemon"}],"deleted_at":"2025-12-25T22:16:51.656247Z","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"NetworkView-587.2","title":"Design DuckDB spatial join + multi-membership fields","description":"Specify DuckDB SQL to compute intersection length per route/LA and per route/RTP; define primary assignment and multi-membership fields with thresholds.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-25T17:43:35.416347Z","updated_at":"2025-12-25T17:43:35.416347Z","labels":["data","duckdb","spatial"],"dependencies":[{"issue_id":"NetworkView-587.2","depends_on_id":"NetworkView-587","type":"parent-child","created_at":"2025-12-25T17:43:35.419207Z","created_by":"daemon"}]}
{"id":"NetworkView-587.3","title":"Implement DuckDB-based generation + refresh artifacts","description":"Add a DuckDB spatial generation script to output routes.parquet/pmtiles with la_codes/rpt_codes; refresh metadata.json with thresholds and field definitions.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-25T17:43:40.798543Z","updated_at":"2025-12-25T17:43:40.798543Z","labels":["artifacts","data","duckdb","spatial"],"dependencies":[{"issue_id":"NetworkView-587.3","depends_on_id":"NetworkView-587","type":"parent-child","created_at":"2025-12-25T17:43:40.80121Z","created_by":"daemon"}]}
{"id":"NetworkView-587.4","title":"Update UI filters to use multi-membership fields","description":"Adjust map/table filtering to use la_codes/rpt_codes (contains match) with fallback to primary fields; update status/debug messaging.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-25T17:43:46.769462Z","updated_at":"2025-12-25T17:43:46.769462Z","labels":["duckdb","filters","frontend"],"dependencies":[{"issue_id":"NetworkView-587.4","depends_on_id":"NetworkView-587","type":"parent-child","created_at":"2025-12-25T17:43:46.77204Z","created_by":"daemon"}]}
{"id":"NetworkView-587.5","title":"Validate edge cases + document methodology","description":"Check Ember E1 and other multi-LA services; update BASELINE.md + plan.md with DuckDB spatial method + dependency notes.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T17:43:53.018919Z","updated_at":"2025-12-25T17:43:53.018919Z","labels":["data","docs","spatial"],"dependencies":[{"issue_id":"NetworkView-587.5","depends_on_id":"NetworkView-587","type":"parent-child","created_at":"2025-12-25T17:43:53.02203Z","created_by":"daemon"}]}
{"id":"NetworkView-58f","title":"LA/RPT filters not applied until boundary filters populated","description":"Bug: LA/RPT selections do not filter map/table because populateBoundaryFilters was never invoked after DuckDB init. Fix: call populateBoundaryFilters after initDuckDb, add map-filter tests to assert LA/RPT string matching.","notes":"Fixed by calling populateBoundaryFilters after initDuckDb; added app wiring and map-utils tests to cover LA/RPT filter behavior.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-25T20:53:42.181836Z","updated_at":"2025-12-25T20:53:47.54815Z","closed_at":"2025-12-25T20:53:47.548154Z"}
{"id":"NetworkView-5b7","title":"When a map feature is cliced on the map it should be highliighted and prioritied in the table view","description":"Feature: Map selection sync with table view\n\nSummary\nWhen a user clicks a feature on the map, that feature is visually highlighted and brought to the top of the table view.\n\nUser need\nUsers want to quickly see more detail about a map feature without having to search for it in a long table.\n\nBehaviour\n\nClicking a feature on the map selects it.\n\nThe selected feature is highlighted on the map using a clear visual state.\n\nThe same feature is highlighted in the table view.\n\nThe table automatically reorders so the selected feature appears at the top.\n\nIf multiple features are already sorted, the selected feature remains pinned above the existing sort order.\n\nClicking a different map feature updates both the map highlight and the table position.\n\nClicking away clears the selection and returns the table to its previous order.\n\nInteraction notes\n\nHighlighting should be subtle and consistent across map and table.\n\nThe interaction should feel instant, with no visible reload of the table.\n\nKeyboard and touch interactions should behave the same way as mouse clicks.\n\nValue\nThis reduces cognitive load, speeds up inspection of data, and keeps map and table views clearly in sync.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-25T22:27:56.465124Z","updated_at":"2025-12-25T22:27:56.465124Z","comments":[{"id":45,"issue_id":"NetworkView-5b7","author":"home","text":"Map click now focuses the selected service in the table: selection triggers scroll-to-row (with DuckDB index lookup when needed) and table re-render. Applies to map tiles, preview GeoJSON, and deck overlay clicks. Files: public/app.js. Tests: npm test -- --run.","created_at":"2025-12-26T00:10:47Z"}]}
{"id":"NetworkView-5e4","title":"Accessibility: status live region + icon button labels","description":"Status and control affordances are not fully accessible. The status text updates are not announced to screen readers, and several icon-only buttons rely on title text only.\\n\\nContext:\\n- Status element: #status in public/index.html updates frequently via setStatus in public/app.js.\\n- Icon-only buttons: sidebar fullscreen, data inspector filter/expand, close buttons in mock panels.\\n\\nAcceptance criteria:\\n- Add aria-live (polite) and role=\"status\" to the status region.\\n- Add aria-labels to icon-only buttons (filter toggle, expand table, sidebar fullscreen, mock close buttons).\\n- Ensure focus styles are visible on keyboard navigation for key controls.\\n\\nFiles:\\n- public/index.html\\n- public/styles.css (if needed for focus styles)\\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-27T19:20:09.889488Z","updated_at":"2025-12-27T19:20:09.889488Z"}
{"id":"NetworkView-5iz","title":"Bug: Tooltips not working on spatial query action pills","description":"The title attributes added to the Include/Also Include/Exclude action pills in the spatial query builder are not displaying tooltips on hover. Need to investigate if this is a browser/CSS issue or if we need to implement a custom tooltip solution.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-26T10:32:17.684675Z","updated_at":"2025-12-26T10:32:17.684675Z","labels":["bug","ui"]}
{"id":"NetworkView-5lx","title":"Phase 1: Source RPT boundaries (your dataset or external)","description":"Phase: Phase 1 — Data artefacts v1 (PMTiles + Parquet) (3–7 days)\nSection: boundaries\nSource: plan.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:14.853796Z","updated_at":"2025-12-25T16:09:36.926929Z","closed_at":"2025-12-25T16:09:36.926929Z","close_reason":"Closed","labels":["phase-1"],"dependencies":[{"issue_id":"NetworkView-5lx","depends_on_id":"NetworkView-gjy","type":"parent-child","created_at":"2025-12-25T16:04:25.206283Z","created_by":"daemon"}]}
{"id":"NetworkView-5ze","title":"Phase 2: PMTiles integration for routes + boundaries","description":"Phase: Phase 2 — Map Viewer MVP (route lines + clip + filters + linked table) (5–10 days)\nSection: map rendering\nSource: plan.md","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:18.383847Z","updated_at":"2025-12-25T16:04:16.820136Z","labels":["phase-2"],"dependencies":[{"issue_id":"NetworkView-5ze","depends_on_id":"NetworkView-p57","type":"parent-child","created_at":"2025-12-25T16:04:17.213398Z","created_by":"daemon"}]}
{"id":"NetworkView-6rf","title":"Phase 2: Table view (virtualised rows)","description":"Phase: Phase 2 — Map Viewer MVP (route lines + clip + filters + linked table) (5–10 days)\nSection: linked table\nSource: plan.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:21.244406Z","updated_at":"2025-12-25T16:25:08.891635Z","closed_at":"2025-12-25T16:25:08.891635Z","close_reason":"Closed","labels":["phase-2"],"dependencies":[{"issue_id":"NetworkView-6rf","depends_on_id":"NetworkView-p57","type":"parent-child","created_at":"2025-12-25T16:04:10.150527Z","created_by":"daemon"}],"comments":[{"id":1,"issue_id":"NetworkView-6rf","author":"home","text":"Implemented virtualized Data Inspector rows by rendering only visible slices with spacer rows and scroll-driven re-rendering; selection uses event delegation. Added configurable table limit via config.tableLimit (default 2000) so virtualization matters. Files: public/app.js, public/index.html, public/config*.json.","created_at":"2025-12-25T16:24:50Z"}]}
{"id":"NetworkView-6zj","title":"Phase 1: Generate `boundaries_la.pmtiles`","description":"Phase: Phase 1 — Data artefacts v1 (PMTiles + Parquet) (3–7 days)\nSection: boundaries\nSource: plan.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:15.425197Z","updated_at":"2025-12-25T16:09:36.930149Z","closed_at":"2025-12-25T16:09:36.930149Z","close_reason":"Closed","labels":["phase-1"],"dependencies":[{"issue_id":"NetworkView-6zj","depends_on_id":"NetworkView-gjy","type":"parent-child","created_at":"2025-12-25T16:04:24.01764Z","created_by":"daemon"}]}
{"id":"NetworkView-720","title":"Phase 1: Source Local Authority boundaries (your dataset or external)","description":"Phase: Phase 1 — Data artefacts v1 (PMTiles + Parquet) (3–7 days)\nSection: boundaries\nSource: plan.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:14.601098Z","updated_at":"2025-12-25T16:09:36.923995Z","closed_at":"2025-12-25T16:09:36.923995Z","close_reason":"Closed","labels":["phase-1"],"dependencies":[{"issue_id":"NetworkView-720","depends_on_id":"NetworkView-gjy","type":"parent-child","created_at":"2025-12-25T16:04:25.791933Z","created_by":"daemon"}]}
{"id":"NetworkView-79b","title":"SQ-07 Table restriction + CSV export parity","description":"Scope\n- Restrict Data Inspector table to match set.\n- Ensure CSV export uses same match set.\n\nAcceptance\n- Table row count matches map results.\n- CSV contains only matching routes.\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T17:33:24.231742Z","updated_at":"2025-12-25T17:33:24.231742Z","dependencies":[{"issue_id":"NetworkView-79b","depends_on_id":"NetworkView-3uh","type":"parent-child","created_at":"2025-12-25T17:33:24.652173Z","created_by":"daemon"}],"comments":[{"id":55,"issue_id":"NetworkView-79b","author":"home","text":"Validation note (2025-12-27): Ran Playwright on http://127.0.0.1:5137/. SQ panel opens and SLB controls are visible. 'Pick Point on Map' button present. No radius slider detected (input[type=range] count 0) and no visible Evidence text. Table rows remained 0 in my run, even after 'Load GeoJSON preview', so SQ execution/outputs could not be validated (map highlight, table restriction, CSV parity, evidence, edge cases). Screenshots in /tmp: sq-home.png, sq-panel.png, sq-validate-02-point.png, sq-validate-03-run.png, sq-sample-01-loaded.png, sq-sample-04-run.png. Please confirm data-populating environment for re-test.","created_at":"2025-12-27T19:47:12Z"}]}
{"id":"NetworkView-7bs","title":"Phase 1: Generate `boundaries_rpt.pmtiles`","description":"Phase: Phase 1 — Data artefacts v1 (PMTiles + Parquet) (3–7 days)\nSection: boundaries\nSource: plan.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:15.696005Z","updated_at":"2025-12-25T16:09:36.931736Z","closed_at":"2025-12-25T16:09:36.931736Z","close_reason":"Closed","labels":["phase-1"],"dependencies":[{"issue_id":"NetworkView-7bs","depends_on_id":"NetworkView-gjy","type":"parent-child","created_at":"2025-12-25T16:04:23.399106Z","created_by":"daemon"}]}
{"id":"NetworkView-7l0","title":"DuckDB init: force buffer on localhost","description":"Local dev servers often lack Range support; force parquet buffering on localhost even if parquetPreferBuffer is false.","acceptance_criteria":"On localhost, DuckDB uses buffered parquet and shows status warning if parquetPreferBuffer was false.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-25T19:56:41.693843Z","updated_at":"2025-12-25T19:57:13.230154Z","closed_at":"2025-12-25T19:57:13.230154Z","close_reason":"Closed","comments":[{"id":9,"issue_id":"NetworkView-7l0","author":"home","text":"Implemented localhost buffer override in DuckDB init; uses buffered parquet even if parquetPreferBuffer is false and emits status warning. Tests: npm test -- --run.","created_at":"2025-12-25T19:56:57Z"}]}
{"id":"NetworkView-7th","title":"Phase 2: Operator filter (typeahead multi-select)","description":"Phase: Phase 2 — Map Viewer MVP (route lines + clip + filters + linked table) (5–10 days)\nSection: filtering\nSource: plan.md","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:19.930745Z","updated_at":"2025-12-25T16:04:12.993176Z","labels":["phase-2"],"dependencies":[{"issue_id":"NetworkView-7th","depends_on_id":"NetworkView-p57","type":"parent-child","created_at":"2025-12-25T16:04:13.42907Z","created_by":"daemon"}]}
{"id":"NetworkView-7ug","title":"SLB-04 Evidence sentence + copy","description":"Scope\n- Generate plain-English sentence summary.\n- Include in Evidence panel and copy note.\n\nAcceptance\n- Evidence contains all blocks with parameters and thresholds.\n- Copy note is report-ready.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T20:58:09.449431Z","updated_at":"2025-12-25T21:54:46.262576Z","closed_at":"2025-12-25T21:54:46.262576Z","close_reason":"Duplicate: evidence sentence handled in NetworkView-2k2","dependencies":[{"issue_id":"NetworkView-7ug","depends_on_id":"NetworkView-1tt","type":"parent-child","created_at":"2025-12-25T20:58:09.873649Z","created_by":"daemon"}],"comments":[{"id":21,"issue_id":"NetworkView-7ug","author":"home","text":"Design mockup available at public/design/index.html (served at /design/). May need edits to align with spec before wiring into app.","created_at":"2025-12-25T21:52:34Z"}]}
{"id":"NetworkView-7wl","title":"Add Playwright E2E filter test to CI","description":"Persist extended Playwright filter walkthrough and wire into CI to catch runtime filter regressions.","acceptance_criteria":"tests/e2e/filtering.e2e.js present, npm run test:e2e works, GitHub Actions runs e2e with Playwright.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T20:57:23.826964Z","updated_at":"2025-12-25T20:57:59.411664Z","closed_at":"2025-12-25T20:57:59.411664Z","close_reason":"Closed","comments":[{"id":13,"issue_id":"NetworkView-7wl","author":"home","text":"Added Playwright E2E filter walkthrough, wired into npm script and CI workflow. Unit tests run; e2e runs in CI with Playwright browsers.","created_at":"2025-12-25T20:57:40Z"}]}
{"id":"NetworkView-8ca","title":"Phase 1: Normalise and clean attributes","description":"Phase: Phase 1 — Data artefacts v1 (PMTiles + Parquet) (3–7 days)\nSection: route lines\nSource: plan.md\nDetails:\n- ensure stable `service_id`\n- ensure operator and mode values are consistent","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:16.17441Z","updated_at":"2025-12-25T16:09:36.934799Z","closed_at":"2025-12-25T16:09:36.934799Z","close_reason":"Closed","labels":["phase-1"],"dependencies":[{"issue_id":"NetworkView-8ca","depends_on_id":"NetworkView-gjy","type":"parent-child","created_at":"2025-12-25T16:04:22.165192Z","created_by":"daemon"}]}
{"id":"NetworkView-8z1","title":"Bug: Spatial query additional operations still overflowing","description":"The blocks container in the spatial query builder still appears to overflow despite adding max-h-40 and overflow-y-auto classes. The scrollable container may not be working as expected. Need to verify the HTML structure and ensure the scrollbar appears when there are many blocks.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-26T10:32:18.117421Z","updated_at":"2025-12-26T10:32:18.117421Z","labels":["bug","ui"]}
{"id":"NetworkView-952","title":"Phase 3: “Send to MapBuilder” stores a `MapArtefactDraft` (JSON spec)","description":"Phase: Phase 3 — Snapshot export + MapBuilder hand-off (3–7 days)\nSection: MapBuilder scaffold (minimal)\nSource: plan.md","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:23.5469Z","updated_at":"2025-12-25T16:04:03.253763Z","labels":["phase-3"],"dependencies":[{"issue_id":"NetworkView-952","depends_on_id":"NetworkView-wu5","type":"parent-child","created_at":"2025-12-25T16:04:03.700903Z","created_by":"daemon"}]}
{"id":"NetworkView-a1m","title":"Phase 0: Define central configuration","description":"Phase: Phase 0 — Repo + foundations (1–2 days)\nSource: plan.md\nDetails:\n- `config/definitions.json` (time bands, default styling, thresholds)\n- `config/sources.json` (dataset attribution, update frequency)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:14.11075Z","updated_at":"2025-12-25T16:04:26.636723Z","closed_at":"2025-12-25T15:57:29.036625Z","labels":["phase-0"],"dependencies":[{"issue_id":"NetworkView-a1m","depends_on_id":"NetworkView-qnr","type":"parent-child","created_at":"2025-12-25T16:04:27.245563Z","created_by":"daemon"}]}
{"id":"NetworkView-a72","title":"SQ-04 Spatial logic selector + readable sentence","description":"Scope\n- Implement logic options:\n  1) NEAR(point, radius)\n  2) INTERSECTS(boundary)\n  3) NEAR(point, radius) AND INTERSECTS(boundary)\n- Render as human-readable sentence.\n\nAcceptance\n- Logic selector is plain English.\n- Active logic displayed (e.g., \"Routes within 300m of point AND intersect boundary\").\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T17:33:22.229755Z","updated_at":"2025-12-25T21:54:47.280839Z","closed_at":"2025-12-25T21:54:47.280839Z","close_reason":"Superseded by SLB-03 (builder handles logic selection + sentence)","dependencies":[{"issue_id":"NetworkView-a72","depends_on_id":"NetworkView-3uh","type":"parent-child","created_at":"2025-12-25T17:33:22.641143Z","created_by":"daemon"}],"comments":[{"id":17,"issue_id":"NetworkView-a72","author":"home","text":"Design mockup available at public/design/index.html (served at /design/). May need edits to align with spec before wiring into app.","created_at":"2025-12-25T21:52:33Z"}]}
{"id":"NetworkView-adx","title":"Phase 3 integration: fix filter wiring for table/export/service search","description":"Refactor moved filter helpers to modules; several call sites in app.js and table/export modules stopped passing UI inputs or filter objects, disabling filters or breaking exports.","acceptance_criteria":"Service search/operators/time bands apply in buildWhere/buildMapFilter; table paging and exports use current filters; download handlers wired with dependencies; no runtime errors from missing filter args.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-25T19:46:56.299182Z","updated_at":"2025-12-25T19:47:33.744629Z","closed_at":"2025-12-25T19:47:33.744629Z","close_reason":"Closed","comments":[{"id":7,"issue_id":"NetworkView-adx","author":"home","text":"Fixed filter wiring after modular refactor: pass operator/time-band/service-search inputs through app.js, propagate filters into table paging/queryTable, and thread filters into export handlers. Updated download click handlers to provide dependencies. Tests: npm test -- --run.","created_at":"2025-12-25T19:47:17Z"}]}
{"id":"NetworkView-ags","title":"Phase 4: Add timetable-derived flags for time bands","description":"Phase: Phase 4 — Performance hardening + real time bands (as data allows) (ongoing)\nSource: plan.md\nDetails:\n- `runs_evening`, `runs_night`, `runs_sunday`","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:24.50867Z","updated_at":"2025-12-25T16:04:00.413425Z","labels":["phase-4"],"dependencies":[{"issue_id":"NetworkView-ags","depends_on_id":"NetworkView-zds","type":"parent-child","created_at":"2025-12-25T16:04:00.860123Z","created_by":"daemon"}]}
{"id":"NetworkView-b43","title":"Phase 1: Generate `routes.pmtiles` with above properties present on tile features","description":"Phase: Phase 1 — Data artefacts v1 (PMTiles + Parquet) (3–7 days)\nSection: route lines\nSource: plan.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:16.680558Z","updated_at":"2025-12-25T16:09:36.937554Z","closed_at":"2025-12-25T16:09:36.937554Z","close_reason":"Closed","labels":["phase-1"],"dependencies":[{"issue_id":"NetworkView-b43","depends_on_id":"NetworkView-gjy","type":"parent-child","created_at":"2025-12-25T16:04:20.953219Z","created_by":"daemon"}]}
{"id":"NetworkView-byi","title":"SQ-09 Edge cases + limits","description":"Scope\n- Handle no results, out-of-extent points, oversized boundaries.\n- Cap radius (e.g., 2km) and polygon complexity.\n- Provide user-friendly warnings.\n\nAcceptance\n- Clear guidance for zero results or slow queries.\n- Limits enforced without crashes.\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T17:33:25.595742Z","updated_at":"2025-12-25T17:33:25.595742Z","dependencies":[{"issue_id":"NetworkView-byi","depends_on_id":"NetworkView-3uh","type":"parent-child","created_at":"2025-12-25T17:33:25.996521Z","created_by":"daemon"}],"comments":[{"id":57,"issue_id":"NetworkView-byi","author":"home","text":"Validation note (2025-12-27): Ran Playwright on http://127.0.0.1:5137/. SQ panel opens and SLB controls are visible. 'Pick Point on Map' button present. No radius slider detected (input[type=range] count 0) and no visible Evidence text. Table rows remained 0 in my run, even after 'Load GeoJSON preview', so SQ execution/outputs could not be validated (map highlight, table restriction, CSV parity, evidence, edge cases). Screenshots in /tmp: sq-home.png, sq-panel.png, sq-validate-02-point.png, sq-validate-03-run.png, sq-sample-01-loaded.png, sq-sample-04-run.png. Please confirm data-populating environment for re-test.","created_at":"2025-12-27T19:47:23Z"}]}
{"id":"NetworkView-cbd","title":"Phase 2: Export current table to CSV (DuckDB query → CSV blob download)","description":"Phase: Phase 2 — Map Viewer MVP (route lines + clip + filters + linked table) (5–10 days)\nSection: exports\nSource: plan.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:22.227535Z","updated_at":"2025-12-25T16:34:06.603869Z","closed_at":"2025-12-25T16:34:06.603873Z","labels":["phase-2"],"dependencies":[{"issue_id":"NetworkView-cbd","depends_on_id":"NetworkView-p57","type":"parent-child","created_at":"2025-12-25T16:04:07.304927Z","created_by":"daemon"}]}
{"id":"NetworkView-ch4","title":"Phase 1: Generate `metadata.json` including","description":"Phase: Phase 1 — Data artefacts v1 (PMTiles + Parquet) (3–7 days)\nSection: metadata\nSource: plan.md\nDetails:\n- dataset versions (hash or timestamp)\n- generated-at time\n- attribution text\n- definitions.json version used","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:17.203208Z","updated_at":"2025-12-25T16:09:36.94057Z","closed_at":"2025-12-25T16:09:36.94057Z","close_reason":"Closed","labels":["phase-1"],"dependencies":[{"issue_id":"NetworkView-ch4","depends_on_id":"NetworkView-gjy","type":"parent-child","created_at":"2025-12-25T16:04:19.768896Z","created_by":"daemon"}]}
{"id":"NetworkView-d4s","title":"Cloud DB Migration","description":"Migrate DuckDB query execution from client-side (browser) to server-side (Cloudflare Workers) to reduce client data transfer from ~50MB to \u003c1MB per query. This will significantly improve scalability and performance for users on slow connections.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-26T11:11:28.723721Z","updated_at":"2025-12-26T11:11:28.723721Z"}
{"id":"NetworkView-d4s.1","title":"Initialize Cloudflare Workers Project","description":"Create directory structure, wrangler.toml, package.json. Configure R2 bucket binding for accessing existing routes.parquet file.","status":"open","priority":1,"issue_type":"task","estimated_minutes":90,"created_at":"2025-12-26T11:12:14.975046Z","updated_at":"2025-12-26T11:12:14.975046Z","dependencies":[{"issue_id":"NetworkView-d4s.1","depends_on_id":"NetworkView-d4s","type":"parent-child","created_at":"2025-12-26T11:12:14.986596Z","created_by":"daemon"}]}
{"id":"NetworkView-d4s.10","title":"Documentation","description":"Update README with new architecture diagram. Document API endpoints and request/response formats. Add deployment guide for Cloudflare Workers setup.","status":"open","priority":2,"issue_type":"task","estimated_minutes":90,"created_at":"2025-12-26T11:12:19.426697Z","updated_at":"2025-12-26T11:12:19.426697Z","dependencies":[{"issue_id":"NetworkView-d4s.10","depends_on_id":"NetworkView-d4s","type":"parent-child","created_at":"2025-12-26T11:12:19.427865Z","created_by":"daemon"}]}
{"id":"NetworkView-d4s.11","title":"Modify Query Execution in Frontend","description":"Update app.js to call API instead of local DuckDB. Update export handlers in public/js/exports/handlers.js. Maintain backward compatibility with useWorkerApi flag.","status":"open","priority":1,"issue_type":"task","estimated_minutes":150,"created_at":"2025-12-26T11:12:28.681404Z","updated_at":"2025-12-26T11:12:28.681404Z","dependencies":[{"issue_id":"NetworkView-d4s.11","depends_on_id":"NetworkView-d4s","type":"parent-child","created_at":"2025-12-26T11:12:28.689984Z","created_by":"daemon"}]}
{"id":"NetworkView-d4s.2","title":"Port DuckDB Initialization to Worker","description":"Copy and adapt DuckDB client code from public/js/duckdb/client.js to Worker environment. Implement schema detection and handle Worker memory constraints (may need 512MB tier).","status":"open","priority":1,"issue_type":"task","estimated_minutes":240,"created_at":"2025-12-26T11:12:15.490237Z","updated_at":"2025-12-26T11:12:15.490237Z","dependencies":[{"issue_id":"NetworkView-d4s.2","depends_on_id":"NetworkView-d4s","type":"parent-child","created_at":"2025-12-26T11:12:15.49173Z","created_by":"daemon"}]}
{"id":"NetworkView-d4s.3","title":"Implement Filter Builder \u0026 Query Logic","description":"Port WHERE clause builder from public/js/filters/builder.js. Create query execution functions for count, table, stats, spatial, and exports. Add result serialization to JSON.","status":"open","priority":1,"issue_type":"task","estimated_minutes":180,"created_at":"2025-12-26T11:12:15.993373Z","updated_at":"2025-12-26T11:12:15.993373Z","dependencies":[{"issue_id":"NetworkView-d4s.3","depends_on_id":"NetworkView-d4s","type":"parent-child","created_at":"2025-12-26T11:12:16.002343Z","created_by":"daemon"}]}
{"id":"NetworkView-d4s.4","title":"Create Worker API Endpoints","description":"Implement request router and CORS handling. Add all API endpoints: /api/query/count, /api/query/table, /api/query/stats/*, /api/export/*. Add error handling and validation.","status":"open","priority":1,"issue_type":"task","estimated_minutes":180,"created_at":"2025-12-26T11:12:16.466213Z","updated_at":"2025-12-26T11:12:16.466213Z","dependencies":[{"issue_id":"NetworkView-d4s.4","depends_on_id":"NetworkView-d4s","type":"parent-child","created_at":"2025-12-26T11:12:16.469906Z","created_by":"daemon"}]}
{"id":"NetworkView-d4s.5","title":"Update Frontend API Client","description":"Add API configuration to config.json and config.r2.json. Create new API client module in public/js/api/client.js. Add useWorkerApi feature flag.","status":"open","priority":1,"issue_type":"task","estimated_minutes":120,"created_at":"2025-12-26T11:12:16.957766Z","updated_at":"2025-12-26T11:12:16.957766Z","dependencies":[{"issue_id":"NetworkView-d4s.5","depends_on_id":"NetworkView-d4s","type":"parent-child","created_at":"2025-12-26T11:12:16.959299Z","created_by":"daemon"}]}
{"id":"NetworkView-d4s.7","title":"Deploy Worker to Production","description":"Deploy Worker with wrangler deploy. Configure custom domain (e.g., api.networkview.example.com). Update production config (config.r2.json) with Worker API URL.","status":"open","priority":1,"issue_type":"task","estimated_minutes":120,"created_at":"2025-12-26T11:12:18.083373Z","updated_at":"2025-12-26T11:12:18.083373Z","dependencies":[{"issue_id":"NetworkView-d4s.7","depends_on_id":"NetworkView-d4s","type":"parent-child","created_at":"2025-12-26T11:12:18.091748Z","created_by":"daemon"}]}
{"id":"NetworkView-d4s.8","title":"End-to-End Testing","description":"Test all features with Worker API: filters, pagination, service search, spatial queries, exports. Performance testing (target \u003c1s response). Error handling validation.","status":"open","priority":1,"issue_type":"task","estimated_minutes":180,"created_at":"2025-12-26T11:12:18.515143Z","updated_at":"2025-12-26T11:12:18.515143Z","dependencies":[{"issue_id":"NetworkView-d4s.8","depends_on_id":"NetworkView-d4s","type":"parent-child","created_at":"2025-12-26T11:12:18.516343Z","created_by":"daemon"}]}
{"id":"NetworkView-d4s.9","title":"Optimization \u0026 Monitoring","description":"Implement result caching for common queries. Add Worker analytics dashboard. Clean up unused client-side DuckDB code (~5-10MB savings). Optimize parquet access patterns.","status":"open","priority":2,"issue_type":"task","estimated_minutes":120,"created_at":"2025-12-26T11:12:18.955148Z","updated_at":"2025-12-26T11:12:18.955148Z","dependencies":[{"issue_id":"NetworkView-d4s.9","depends_on_id":"NetworkView-d4s","type":"parent-child","created_at":"2025-12-26T11:12:18.956373Z","created_by":"daemon"}]}
{"id":"NetworkView-dlm","title":"Filter controls inconsistent (auto-fit jumping, Clear leaves empty table, map filter sometimes not applied)","description":"User reports weird filter behaviour. Audit each control: Mode/Operator/Time band (multi-select), LA/RPT (single), service search, viewport limit checkbox, Clear/Reset.\n\nProblems observed in code:\n- Any filter apply triggers fitMapToScope(), which is jarring once filters auto-apply on change.\n- Clear/Reset currently empties table/stats and does not reload full dataset.\n- Map filter can be a no-op when selected filters exist but tileFields have not been detected (buildMapFilter returns null).\n\nExpected:\n- Changing filter controls updates map + table consistently.\n- Auto-apply on change should not re-fit map each time (only on explicit Apply if desired).\n- Clear/Reset restores full dataset counts/table.\n- Map filtering should retry tile-field detection when filters are set.","acceptance_criteria":"- Changing each filter control (Mode/Operator/Time band/LA/RPT/service search/bbox) updates both map and table.\n- Map only auto-fits on explicit Apply (or behind a flag), not on every change.\n- Clear/Reset restores full selection (non-zero rows) when data exists.\n- Map filtering works even when tileFields start empty (detect/retry), and selection highlight stays constrained.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-25T17:26:05.345306Z","updated_at":"2025-12-25T17:28:27.87544Z","closed_at":"2025-12-25T17:28:27.87544Z","close_reason":"Closed","labels":["filters","phase-2","ui"],"comments":[{"id":4,"issue_id":"NetworkView-dlm","author":"home","text":"Audit + fixes in public/app.js:\n- Only explicit Apply button triggers auto-fit (onApplyFilters({autoFit:true})); auto-apply changes no longer jump the map.\n- Clear/Reset now reloads the full dataset by calling onApplyFilters({autoFit:false}) instead of leaving table empty.\n- applyMapFilters() retries detectTileFieldsFromRendered() when filters are set but buildMapFilter() returns null; adds one-time warning/log if tile attributes still can’t be detected.\n- Map filter match logic now supports selecting '(unknown)' for Mode/Operator (NONE_OPTION_VALUE) so map and table semantics match.\nRan: node --check public/app.js.","created_at":"2025-12-25T17:28:13Z"}]}
{"id":"NetworkView-dmc","title":"Phase 0: Decide dev server + build system","description":"Phase: Phase 0 — Repo + foundations (1–2 days)\nSource: plan.md\nDetails:\n- Vite + React + TypeScript (recommended for simplicity)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:14.354109Z","updated_at":"2025-12-25T16:04:25.995408Z","closed_at":"2025-12-25T15:57:27.582199Z","labels":["phase-0"],"dependencies":[{"issue_id":"NetworkView-dmc","depends_on_id":"NetworkView-qnr","type":"parent-child","created_at":"2025-12-25T16:04:26.409903Z","created_by":"daemon"}]}
{"id":"NetworkView-dp1","title":"Phase 4: Add graceful degradation","description":"Phase: Phase 4 — Performance hardening + real time bands (as data allows) (ongoing)\nSource: plan.md\nDetails:\n- missing links → hide actions\n- missing time flags → disable filter with explanation","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:25.045658Z","updated_at":"2025-12-25T16:03:58.558493Z","labels":["phase-4"],"dependencies":[{"issue_id":"NetworkView-dp1","depends_on_id":"NetworkView-zds","type":"parent-child","created_at":"2025-12-25T16:03:59.54291Z","created_by":"daemon"}]}
{"id":"NetworkView-ds9","title":"Phase 2: Admin panel changes apply globally","description":"Scope\n- Ensure admin panel changes affect all users/sessions (not just local state).\n- Define persistence (e.g., config file write + reload, or shared store).\n\nAcceptance\n- Changes made by admin are visible to other users after reload.\n- Clear indication of when a change is live.\n","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-25T20:35:31.819055Z","updated_at":"2025-12-25T20:35:31.819055Z","dependencies":[{"issue_id":"NetworkView-ds9","depends_on_id":"NetworkView-p57","type":"parent-child","created_at":"2025-12-25T20:35:32.243008Z","created_by":"daemon"},{"issue_id":"NetworkView-ds9","depends_on_id":"NetworkView-3e6","type":"blocks","created_at":"2025-12-25T20:35:32.459596Z","created_by":"daemon"}]}
{"id":"NetworkView-ega","title":"Phase 1: Compute primary `la_code` and `rpt_code` per route line (recommended v1 approach)","description":"Phase: Phase 1 — Data artefacts v1 (PMTiles + Parquet) (3–7 days)\nSection: route lines\nSource: plan.md\nDetails:\n- choose a deterministic rule (e.g., max intersect length)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:16.42586Z","updated_at":"2025-12-25T16:09:36.936153Z","closed_at":"2025-12-25T16:09:36.936153Z","close_reason":"Closed","labels":["phase-1"],"dependencies":[{"issue_id":"NetworkView-ega","depends_on_id":"NetworkView-gjy","type":"parent-child","created_at":"2025-12-25T16:04:21.550352Z","created_by":"daemon"}]}
{"id":"NetworkView-gdk","title":"Phase 2: Service search (route number/name)","description":"Phase: Phase 2 — Map Viewer MVP (route lines + clip + filters + linked table) (5–10 days)\nSection: filtering\nSource: plan.md","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:20.173201Z","updated_at":"2025-12-25T16:04:12.345789Z","labels":["phase-2"],"dependencies":[{"issue_id":"NetworkView-gdk","depends_on_id":"NetworkView-p57","type":"parent-child","created_at":"2025-12-25T16:04:12.753885Z","created_by":"daemon"}]}
{"id":"NetworkView-gi4","title":"Phase 2: Map ↔ table selection (service_id links)","description":"Phase: Phase 2 — Map Viewer MVP (route lines + clip + filters + linked table) (5–10 days)\nSection: linked table\nSource: plan.md","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:21.487396Z","updated_at":"2025-12-25T16:04:08.973593Z","labels":["phase-2"],"dependencies":[{"issue_id":"NetworkView-gi4","depends_on_id":"NetworkView-p57","type":"parent-child","created_at":"2025-12-25T16:04:09.42372Z","created_by":"daemon"}]}
{"id":"NetworkView-gjy","title":"Epic: Phase 1 — Data artefacts v1 (PMTiles + Parquet) (3–7 days)","description":"Goal: route lines and boundaries are served as PMTiles; attribute tables exist as Parquet for DuckDB.\nDeliverables:\n- `routes.pmtiles`, `boundaries_la.pmtiles`, `boundaries_rpt.pmtiles`\n- `routes.parquet`, `operators.parquet` (if available)\n- `metadata.json`\nAcceptance:\n- PMTiles open in a simple MapLibre test page and render at national scale\n- DuckDB-WASM can query `routes.parquet` locally and return counts by operator/mode\nSource: plan.md","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-25T16:03:57.143933Z","updated_at":"2025-12-25T16:03:57.143933Z","labels":["phase-1"]}
{"id":"NetworkView-gwk","title":"LIMIT TO MAP VIEWPOINT not working","description":"the associated checkbox has no function","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-25T16:44:43.857416Z","updated_at":"2025-12-25T23:48:35.353689Z","closed_at":"2025-12-25T23:48:35.353695Z","comments":[{"id":40,"issue_id":"NetworkView-gwk","author":"home","text":"Applied viewport filtering to DuckDB count/table/stats/exports via buildCombinedWhere, and expanded bbox filter to use spatial geometry when available. Added tests for bbox/combined where. Files: public/app.js, public/js/filters/builder.js, public/js/table/renderer.js, public/js/exports/handlers.js, tests/filters.test.js. Tests: npm test.","created_at":"2025-12-25T23:48:01Z"}]}
{"id":"NetworkView-h93","title":"User Console log","description":"The user should be able to access an operation console log, showing information about their session, their queries (spatial or just basic filters) and any errors. This should be accessed by clicking a console icon in the bottom right. This should be unique to the users current session","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-25T17:39:22.028259Z","updated_at":"2025-12-25T22:21:04.600105Z"}
{"id":"NetworkView-haw","title":"SQ-02 Point placement + radius overlay","description":"Scope\n- Allow point placement by map click or search result hook.\n- Show draggable marker.\n- Add radius slider (default) and render buffer circle.\n\nAcceptance\n- Marker appears and can be moved.\n- Radius updates visually as slider moves.\n- Coordinates recorded for evidence.\n\nNotes\n- Default radius to be confirmed (100–400m).\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T17:33:20.89745Z","updated_at":"2025-12-25T17:33:20.89745Z","dependencies":[{"issue_id":"NetworkView-haw","depends_on_id":"NetworkView-3uh","type":"parent-child","created_at":"2025-12-25T17:33:21.330693Z","created_by":"daemon"}],"comments":[{"id":51,"issue_id":"NetworkView-haw","author":"home","text":"Validation note (2025-12-27): Ran Playwright on http://127.0.0.1:5137/. SQ panel opens and SLB controls are visible. 'Pick Point on Map' button present. No radius slider detected (input[type=range] count 0) and no visible Evidence text. Table rows remained 0 in my run, even after 'Load GeoJSON preview', so SQ execution/outputs could not be validated (map highlight, table restriction, CSV parity, evidence, edge cases). Screenshots in /tmp: sq-home.png, sq-panel.png, sq-validate-02-point.png, sq-validate-03-run.png, sq-sample-01-loaded.png, sq-sample-04-run.png. Please confirm data-populating environment for re-test.","created_at":"2025-12-27T19:46:51Z"}]}
{"id":"NetworkView-hr4","title":"Phase 2: Evidence strip visible","description":"Phase: Phase 2 — Map Viewer MVP (route lines + clip + filters + linked table) (5–10 days)\nSection: exports\nSource: plan.md\nDetails:\n- scope summary, filters, dataset version, definitions version","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:22.479283Z","updated_at":"2025-12-25T16:04:05.984636Z","labels":["phase-2"],"dependencies":[{"issue_id":"NetworkView-hr4","depends_on_id":"NetworkView-p57","type":"parent-child","created_at":"2025-12-25T16:04:06.519558Z","created_by":"daemon"}]}
{"id":"NetworkView-i4s","title":"Phase 2: Copy buttons for service_id/operator_code","description":"Phase: Phase 2 — Map Viewer MVP (route lines + clip + filters + linked table) (5–10 days)\nSection: inspector + drill-through\nSource: plan.md","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:21.979938Z","updated_at":"2025-12-25T16:04:07.564799Z","labels":["phase-2"],"dependencies":[{"issue_id":"NetworkView-i4s","depends_on_id":"NetworkView-p57","type":"parent-child","created_at":"2025-12-25T16:04:08.139209Z","created_by":"daemon"}]}
{"id":"NetworkView-iau","title":"Phase 1: Generate `routes.parquet` attribute table for DuckDB (same keys + richer columns)","description":"Phase: Phase 1 — Data artefacts v1 (PMTiles + Parquet) (3–7 days)\nSection: route lines\nSource: plan.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:16.93643Z","updated_at":"2025-12-25T16:09:36.939074Z","closed_at":"2025-12-25T16:09:36.939074Z","close_reason":"Closed","labels":["phase-1"],"dependencies":[{"issue_id":"NetworkView-iau","depends_on_id":"NetworkView-gjy","type":"parent-child","created_at":"2025-12-25T16:04:20.358805Z","created_by":"daemon"}]}
{"id":"NetworkView-jem","title":"SQ-03 Boundary definition options","description":"Scope\n- Provide boundary choice: radius buffer (v1), admin boundary (LA/RPT) if available.\n- Optional v1.1: polygon draw/lasso (if included, cap vertices + simplify).\n\nAcceptance\n- Selected admin boundary highlights and name shown.\n- Boundary selection updates visible overlay.\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T17:33:21.559986Z","updated_at":"2025-12-25T17:33:21.559986Z","dependencies":[{"issue_id":"NetworkView-jem","depends_on_id":"NetworkView-3uh","type":"parent-child","created_at":"2025-12-25T17:33:21.991167Z","created_by":"daemon"}],"comments":[{"id":16,"issue_id":"NetworkView-jem","author":"home","text":"Design mockup available at public/design/index.html (served at /design/). May need edits to align with spec before wiring into app.","created_at":"2025-12-25T21:52:33Z"},{"id":52,"issue_id":"NetworkView-jem","author":"home","text":"Validation note (2025-12-27): Ran Playwright on http://127.0.0.1:5137/. SQ panel opens and SLB controls are visible. 'Pick Point on Map' button present. No radius slider detected (input[type=range] count 0) and no visible Evidence text. Table rows remained 0 in my run, even after 'Load GeoJSON preview', so SQ execution/outputs could not be validated (map highlight, table restriction, CSV parity, evidence, edge cases). Screenshots in /tmp: sq-home.png, sq-panel.png, sq-validate-02-point.png, sq-validate-03-run.png, sq-sample-01-loaded.png, sq-sample-04-run.png. Please confirm data-populating environment for re-test.","created_at":"2025-12-27T19:46:56Z"}]}
{"id":"NetworkView-jgp","title":"Phase 2: MapLibre map with basemap style","description":"Phase: Phase 2 — Map Viewer MVP (route lines + clip + filters + linked table) (5–10 days)\nSection: map rendering\nSource: plan.md","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:18.034937Z","updated_at":"2025-12-25T16:04:17.411486Z","labels":["phase-2"],"dependencies":[{"issue_id":"NetworkView-jgp","depends_on_id":"NetworkView-p57","type":"parent-child","created_at":"2025-12-25T16:04:17.810042Z","created_by":"daemon"}]}
{"id":"NetworkView-k33","title":"Phase 4: Add caching headers + CDN rules for PMTiles/Parquet","description":"Phase: Phase 4 — Performance hardening + real time bands (as data allows) (ongoing)\nSource: plan.md","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:24.281759Z","updated_at":"2025-12-25T16:04:01.07443Z","labels":["phase-4"],"dependencies":[{"issue_id":"NetworkView-k33","depends_on_id":"NetworkView-zds","type":"parent-child","created_at":"2025-12-25T16:04:01.57053Z","created_by":"daemon"}]}
{"id":"NetworkView-k89","title":"Phase 2: Clip control","description":"Phase: Phase 2 — Map Viewer MVP (route lines + clip + filters + linked table) (5–10 days)\nSection: clipping\nSource: plan.md\nDetails:\n- choose LA by dropdown/search\n- choose RPT by dropdown/search","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:18.868202Z","updated_at":"2025-12-25T16:04:15.528403Z","labels":["phase-2"],"dependencies":[{"issue_id":"NetworkView-k89","depends_on_id":"NetworkView-p57","type":"parent-child","created_at":"2025-12-25T16:04:15.955765Z","created_by":"daemon"}]}
{"id":"NetworkView-k9r","title":"Phase 0: Create mono-repo structure","description":"Phase: Phase 0 — Repo + foundations (1–2 days)\nSource: plan.md\nDetails:\n- `apps/web` (Map Viewer UI)\n- `packages/data-pipeline` (scripts)\n- `data/` (local dev artefacts)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:13.879984Z","updated_at":"2025-12-25T16:04:27.479599Z","closed_at":"2025-12-25T15:57:31.601326Z","labels":["phase-0"],"dependencies":[{"issue_id":"NetworkView-k9r","depends_on_id":"NetworkView-qnr","type":"parent-child","created_at":"2025-12-25T16:04:27.928754Z","created_by":"daemon"}]}
{"id":"NetworkView-kaz","title":"Phase 4: Add smoke tests","description":"Phase: Phase 4 — Performance hardening + real time bands (as data allows) (ongoing)\nSource: plan.md\nDetails:\n- “LA clip returns expected counts”\n- “Operator filter yields stable totals”\n\nAdditional scope: add lightweight diagnostic logging for key user actions and error paths so smoke tests can verify expected telemetry and failure modes.\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:24.749794Z","updated_at":"2025-12-25T16:38:36.33875Z","labels":["phase-4"],"dependencies":[{"issue_id":"NetworkView-kaz","depends_on_id":"NetworkView-zds","type":"parent-child","created_at":"2025-12-25T16:04:00.203036Z","created_by":"daemon"}]}
{"id":"NetworkView-kih","title":"Phase 2: Save “Map State” as JSON (local storage v1 is fine)","description":"Phase: Phase 2 — Map Viewer MVP (route lines + clip + filters + linked table) (5–10 days)\nSection: exports\nSource: plan.md","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:22.789673Z","updated_at":"2025-12-25T16:04:05.247239Z","labels":["phase-2"],"dependencies":[{"issue_id":"NetworkView-kih","depends_on_id":"NetworkView-p57","type":"parent-child","created_at":"2025-12-25T16:04:05.721433Z","created_by":"daemon"}]}
{"id":"NetworkView-ler","title":"Wire or hide non-functional tabs and layer toggles","description":"Header tabs (Map \u0026 Table / Insights / Reporting) and the Layers panel checkboxes are visible but have no wiring, which hurts trust and invites clicks that do nothing.\\n\\nContext:\\n- Header tab buttons in public/index.html are static; no data-tab bindings.\\n- Layers panel checkboxes in public/index.html are static; no listeners in public/app.js.\\n\\nAcceptance criteria:\\n- Either wire tabs/layer toggles to real behavior OR hide/disable them behind feature flags with \"Coming soon\" affordances.\\n- If disabled, use aria-disabled and tooltip copy explaining status.\\n\\nFiles:\\n- public/index.html\\n- public/app.js (if wiring)\\n- public/js/map/utils.js (if layer visibility handlers added)\\n","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-27T19:19:50.725983Z","updated_at":"2025-12-27T19:19:50.725983Z"}
{"id":"NetworkView-lko","title":"SQ-06 Map highlighting + dim non-matching routes","description":"Scope\n- Use match set to highlight routes and optionally dim non-matching.\n- Keep point/boundary overlays visible until cleared.\n\nAcceptance\n- Matches are visually distinct (thicker line/stronger color).\n- Optional toggle for dimming non-matching.\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T17:33:23.577142Z","updated_at":"2025-12-25T17:33:23.577142Z","dependencies":[{"issue_id":"NetworkView-lko","depends_on_id":"NetworkView-3uh","type":"parent-child","created_at":"2025-12-25T17:33:23.999143Z","created_by":"daemon"}],"comments":[{"id":54,"issue_id":"NetworkView-lko","author":"home","text":"Validation note (2025-12-27): Ran Playwright on http://127.0.0.1:5137/. SQ panel opens and SLB controls are visible. 'Pick Point on Map' button present. No radius slider detected (input[type=range] count 0) and no visible Evidence text. Table rows remained 0 in my run, even after 'Load GeoJSON preview', so SQ execution/outputs could not be validated (map highlight, table restriction, CSV parity, evidence, edge cases). Screenshots in /tmp: sq-home.png, sq-panel.png, sq-validate-02-point.png, sq-validate-03-run.png, sq-sample-01-loaded.png, sq-sample-04-run.png. Please confirm data-populating environment for re-test.","created_at":"2025-12-27T19:47:07Z"}]}
{"id":"NetworkView-mai","title":"Map filter wiring: pass tileFields into buildMapFilter","description":"buildMapFilter expects tileFields; app.js called it without tileFields, causing runtime crash when MapLibre idle fires.","acceptance_criteria":"applyMapFilters passes tileFields; detectTileFieldsFromRendered updates state; buildMapFilter guards missing tileFields; wiring test added.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-25T20:07:48.750742Z","updated_at":"2025-12-25T20:08:38.278263Z","closed_at":"2025-12-25T20:08:38.278263Z","close_reason":"Closed","comments":[{"id":11,"issue_id":"NetworkView-mai","author":"home","text":"Fixed applyMapFilters to pass tileFields and persist detected tile fields; added buildMapFilter default param guard + wiring test update. Tests: npm test -- --run.","created_at":"2025-12-25T20:08:16Z"}]}
{"id":"NetworkView-p57","title":"Epic: Phase 2 — Map Viewer MVP (route lines + clip + filters + linked table) (5–10 days)","description":"Goal: a planner can find a place, clip to LA/RPT, filter routes, inspect, and export a CSV.\nDeliverables:\n- Map Viewer usable end-to-end for route lines\n- CSV export working\n- Evidence strip present\nAcceptance:\n- User can:\n- Table row count matches the map feature set under the same filters (within defined rules)\nSource: plan.md","status":"in_progress","priority":1,"issue_type":"epic","created_at":"2025-12-25T16:03:57.402197Z","updated_at":"2025-12-25T16:39:18.312969Z","labels":["phase-2"]}
{"id":"NetworkView-p57.1","title":"Phase 2: Virtualised table follow-ups (row height + paging)","description":"Context\\n- Data Inspector table uses scroll-window virtualisation (spacer rows + visible slice) and a configurable tableLimit (default 2000).\\n\\nProblems\\n- Virtualisation assumes fixed row height; style/font changes can desync scroll math.\\n- Large selections still need paging/offset or adaptive limits to avoid heavy single-shot DuckDB queries.\\n\\nAcceptance\\n- Measure row height dynamically (at least once per render) to keep spacer math accurate.\\n- Add paging (LIMIT/OFFSET) or adaptive tableLimit based on selection size/device to keep UI responsive for \u003e10k rows.\\n- Selection, keyboard nav, and exports/evidence remain consistent under paging/virtualisation.\\n\\nImplementation notes\\n- Files: public/app.js (renderTable + queryTable).\\n- Consider adding a per-query cache keyed by filter state to avoid requerying on scroll.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T16:25:48.888583Z","updated_at":"2025-12-25T16:41:41.953551Z","closed_at":"2025-12-25T16:41:41.953551Z","close_reason":"Closed","labels":["phase-2"],"dependencies":[{"issue_id":"NetworkView-p57.1","depends_on_id":"NetworkView-p57","type":"parent-child","created_at":"2025-12-25T16:25:48.889828Z","created_by":"home"},{"issue_id":"NetworkView-p57.1","depends_on_id":"NetworkView-6rf","type":"parent-child","created_at":"2025-12-25T16:38:21.810206Z","created_by":"daemon"}],"comments":[{"id":2,"issue_id":"NetworkView-p57.1","author":"home","text":"Completed: added dynamic row height measurement (measures first rendered row and adjusts virtual rowHeight), and added paging (LIMIT/OFFSET) with lazy page fetch based on scroll position. Added browse cap disclosure in evidence/table meta and made tableLimit/pageSize/browseMax configurable (config.tableLimit/tablePageSize/tableBrowseMax). Updated selection click handling to work under paging. Files: public/app.js, public/config.json, public/config.sample.json, public/config.r2.json.","created_at":"2025-12-25T16:41:20Z"}]}
{"id":"NetworkView-qk1","title":"SLB-05 Exclude operators/modes","description":"Scope\n- Implement Exclude blocks for operator + mode.\n- Apply exclusions after include blocks.\n\nAcceptance\n- Excluding operator/mode removes routes from map/table.\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T20:58:10.099702Z","updated_at":"2025-12-25T20:58:10.099702Z","dependencies":[{"issue_id":"NetworkView-qk1","depends_on_id":"NetworkView-1tt","type":"parent-child","created_at":"2025-12-25T20:58:10.524474Z","created_by":"daemon"}]}
{"id":"NetworkView-qn3","title":"Phase 4: Convert large layers to multiple PMTiles by theme if needed","description":"Phase: Phase 4 — Performance hardening + real time bands (as data allows) (ongoing)\nSource: plan.md","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:24.024922Z","updated_at":"2025-12-25T16:04:01.803779Z","labels":["phase-4"],"dependencies":[{"issue_id":"NetworkView-qn3","depends_on_id":"NetworkView-zds","type":"parent-child","created_at":"2025-12-25T16:04:02.290408Z","created_by":"daemon"}]}
{"id":"NetworkView-qnr","title":"Epic: Phase 0 — Repo + foundations (1–2 days)","description":"Goal: establish a working shell and tooling.\nDeliverables:\n- Running local web app scaffold with placeholder layout\n- Config files committed\nAcceptance:\n- `pnpm dev` (or `npm run dev`) launches app and renders a placeholder map container and table container\nSource: plan.md","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-25T16:03:56.886524Z","updated_at":"2025-12-25T16:03:56.886524Z","labels":["phase-0"]}
{"id":"NetworkView-rkd","title":"When a place is found via geocoder the pin in the map does not match the rest of the UI and does dot clear when filter state is reset","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-25T23:11:08.041129Z","updated_at":"2025-12-25T23:48:17.973964Z","closed_at":"2025-12-25T23:48:17.974157Z","comments":[{"id":39,"issue_id":"NetworkView-rkd","author":"home","text":"Synced geocoder selection with spatial point overlay/label and added geocoder marker cleanup on filter reset (also clears place search UI). Files: public/app.js. Tests: npm test.","created_at":"2025-12-25T23:47:41Z"}]}
{"id":"NetworkView-rsf","title":"Phase 3: MapBuilder shows the same view and allows","description":"Phase: Phase 3 — Snapshot export + MapBuilder hand-off (3–7 days)\nSection: MapBuilder scaffold (minimal)\nSource: plan.md\nDetails:\n- title/subtitle edits\n- annotation text box (simple)\n- export again","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:23.783328Z","updated_at":"2025-12-25T16:04:02.521948Z","labels":["phase-3"],"dependencies":[{"issue_id":"NetworkView-rsf","depends_on_id":"NetworkView-wu5","type":"parent-child","created_at":"2025-12-25T16:04:03.015143Z","created_by":"daemon"}]}
{"id":"NetworkView-ruy","title":"Phase 2 - console log","description":"add in console log that records appropriate details of user actions. and prints relevant errors for diagnosis","notes":"Investigated LA/RPT filter issue; MapLibre tile filter now coerces LA/RPT codes to strings when matching (commit on phase-3-integration).","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-25T16:17:32.720598Z","updated_at":"2025-12-25T20:43:11.514078Z","closed_at":"2025-12-25T17:14:24.236963Z"}
{"id":"NetworkView-u7q","title":"Phase 2: Display active boundary outline and name","description":"Phase: Phase 2 — Map Viewer MVP (route lines + clip + filters + linked table) (5–10 days)\nSection: clipping\nSource: plan.md","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:19.40238Z","updated_at":"2025-12-25T16:04:14.233842Z","labels":["phase-2"],"dependencies":[{"issue_id":"NetworkView-u7q","depends_on_id":"NetworkView-p57","type":"parent-child","created_at":"2025-12-25T16:04:14.638504Z","created_by":"daemon"}]}
{"id":"NetworkView-ucr","title":"SQ-05 Query execution (DuckDB) + service_id match set","description":"Scope\n- Compute matching service_id list from point/boundary/logic.\n- Decide v1 method (bbox/radius approximation vs geometry ST_DWithin/ST_Intersects).\n- Return match set for map + table.\n\nAcceptance\n- Typical city-scale query completes ~1–2s.\n- No full-page re-render or jank.\n\nNotes\n- v1 likely: bbox/radius approximation; v1.1: true geometry refine.\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T17:33:22.908094Z","updated_at":"2025-12-25T17:33:22.908094Z","dependencies":[{"issue_id":"NetworkView-ucr","depends_on_id":"NetworkView-3uh","type":"parent-child","created_at":"2025-12-25T17:33:23.359876Z","created_by":"daemon"}],"comments":[{"id":53,"issue_id":"NetworkView-ucr","author":"home","text":"Validation note (2025-12-27): Ran Playwright on http://127.0.0.1:5137/. SQ panel opens and SLB controls are visible. 'Pick Point on Map' button present. No radius slider detected (input[type=range] count 0) and no visible Evidence text. Table rows remained 0 in my run, even after 'Load GeoJSON preview', so SQ execution/outputs could not be validated (map highlight, table restriction, CSV parity, evidence, edge cases). Screenshots in /tmp: sq-home.png, sq-panel.png, sq-validate-02-point.png, sq-validate-03-run.png, sq-sample-01-loaded.png, sq-sample-04-run.png. Please confirm data-populating environment for re-test.","created_at":"2025-12-27T19:47:02Z"}]}
{"id":"NetworkView-v9p","title":"Multi-select defaults filter table to (none); map/table out of sync","description":"Repro: load app with metadata-driven multi-select filters (Mode/Operator). Browser auto-selects the first option, which is '(none)', causing buildWhere() to apply an unknown-only filter =\u003e queryCount returns 0 and Data Inspector shows 'Rows 0–0 of 0' even though routes render on the map.\n\nAlso: changing Mode/Operator/LA/RPT/Time band should immediately apply filters (map + table), but only some controls auto-apply today.\n\nExpected: On first load, no filter is applied by default (multi-selects start with no selection), initial table loads all routes, and changing any filter control updates the map/table consistently.","acceptance_criteria":"- Fresh load shows non-zero selection/table when data exists.\n- Multi-selects start with no selected option.\n- Changing Mode/Operator/LA/RPT/Time band applies map+table filters (debounced) without requiring the Apply button.\n- No console errors from rapid filter changes.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-25T17:15:31.11326Z","updated_at":"2025-12-25T17:16:25.847083Z","closed_at":"2025-12-25T17:16:25.847083Z","close_reason":"Closed","labels":["phase-2","regression","ui"],"comments":[{"id":3,"issue_id":"NetworkView-v9p","author":"home","text":"Implemented fix in public/app.js: clear default selections for multi-selects after fillSelect() so (none) is not auto-selected on load; add debounced change listeners for Mode/Operator/Time band/LA/RPT to call onApplyFilters(); add state.applyingFilters guard to coalesce rapid apply calls. Ran: node --check public/app.js.","created_at":"2025-12-25T17:16:12Z"}]}
{"id":"NetworkView-wgy","title":"Clarify filter apply model (auto-apply vs Apply button)","description":"The UI presents an explicit \"Apply filters\" action, but filters auto-apply on change (debounced) for most controls. This creates a split mental model and makes it unclear when changes are live.\\n\\nContext:\\n- Auto-apply debounce in public/app.js (filter change bindings).\\n- Apply button + Reset visible in public/index.html Actions section.\\n\\nAcceptance criteria:\\n- Decide and document one model (explicit apply OR auto-apply) and align UI copy/behavior.\\n- If auto-apply: rename button to \"Re-run\" or \"Apply now\" and add an \"Auto\" indicator or toggle; add a brief hint near Actions.\\n- If manual apply: remove debounce auto-apply and show a \"pending changes\" indicator.\\n- Update status/preview messaging to match the chosen model.\\n\\nFiles:\\n- public/index.html\\n- public/app.js\\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-27T19:19:32.968697Z","updated_at":"2025-12-27T19:19:32.968697Z"}
{"id":"NetworkView-wrn","title":"SQ-01 UI shell + state for spatial query","description":"Scope\n- Add Spatial Query panel under Scope with collapsed default.\n- Add map toolbar (Place point, Draw boundary, Logic, Run, Clear).\n- Define client state model for point, radius, boundary, logic, results.\n\nAcceptance\n- Panel opens/closes without breaking existing filters.\n- Tool can be toggled on/off and reset/clear.\n- State persists during session and restores previous view when cleared.\n\nFiles\n- public/index.html, public/styles.css, public/app.js\n","notes":"UI shell complete: full builder panel added to index.html with Builder/Templates tabs, Find/That/Dist/Of controls, block system with Include/Also Include/Exclude pills, plain-English summary, point picker button, Clear/Run actions. State management in place via spatial/builder.js (438 lines). Feature flag spatialQuery enabled in config files. Execution pipeline still pending (runner is stub).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T17:33:20.101343Z","updated_at":"2025-12-26T10:38:03.83541Z","closed_at":"2025-12-26T10:38:03.835733Z","dependencies":[{"issue_id":"NetworkView-wrn","depends_on_id":"NetworkView-3uh","type":"parent-child","created_at":"2025-12-25T17:33:20.635074Z","created_by":"daemon"}],"comments":[{"id":15,"issue_id":"NetworkView-wrn","author":"home","text":"Design mockup available at public/design/index.html (served at /design/). May need edits to align with spec before wiring into app.","created_at":"2025-12-25T21:52:32Z"}]}
{"id":"NetworkView-wu5","title":"Epic: Phase 3 — Snapshot export + MapBuilder hand-off (3–7 days)","description":"Goal: create report-ready visuals without GIS.\nDeliverables:\n- Report-ready PNG export\n- Evidence note copy feature\n- Minimal MapBuilder that reuses Viewer state\nAcceptance:\n- Exported PNG can be dropped into a Word report and is self-explanatory without additional context\n- Evidence note can be pasted into an appendix and matches the export scope\nSource: plan.md","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-25T16:03:57.646405Z","updated_at":"2025-12-25T16:03:57.646405Z","labels":["phase-3"]}
{"id":"NetworkView-x76","title":"Phase 2: Mode filter (multi-select)","description":"Phase: Phase 2 — Map Viewer MVP (route lines + clip + filters + linked table) (5–10 days)\nSection: filtering\nSource: plan.md","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:19.654832Z","updated_at":"2025-12-25T16:04:13.630735Z","labels":["phase-2"],"dependencies":[{"issue_id":"NetworkView-x76","depends_on_id":"NetworkView-p57","type":"parent-child","created_at":"2025-12-25T16:04:14.029249Z","created_by":"daemon"}]}
{"id":"NetworkView-yas","title":"Phase 2: Time band filter (enabled if flags exist, otherwise disabled with “coming soon”)","description":"Phase: Phase 2 — Map Viewer MVP (route lines + clip + filters + linked table) (5–10 days)\nSection: filtering\nSource: plan.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T15:55:20.410612Z","updated_at":"2025-12-25T16:47:08.615031Z","closed_at":"2025-12-25T16:47:08.615035Z","labels":["phase-2"],"dependencies":[{"issue_id":"NetworkView-yas","depends_on_id":"NetworkView-p57","type":"parent-child","created_at":"2025-12-25T16:04:12.12606Z","created_by":"daemon"}]}
{"id":"NetworkView-zds","title":"Epic: Phase 4 — Performance hardening + real time bands (as data allows) (ongoing)","description":"Goal: make the existing `public/` UI “real” (filters → map → table → inspector → exports) without introducing a bundler yet.\nAcceptance:\n- Viewer remains responsive with Scotland-wide view and typical filters\n- Time band filter behaviour is correct and disclosed in Evidence\nSource: plan.md","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-25T16:03:57.920182Z","updated_at":"2025-12-25T16:03:57.920182Z","labels":["phase-4"]}
